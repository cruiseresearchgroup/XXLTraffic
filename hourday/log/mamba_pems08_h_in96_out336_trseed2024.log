Args in experiment:
Namespace(activation='gelu', anomaly_ratio=0.25, batch_size=32, c_out=212, checkpoints='./checkpoints/', d_conv=4, d_ff=16, d_layers=1, d_model=128, data='custom', data_path='pems08_h.csv', dec_in=151, des='Exp', devices='0,1,2,3', distil=True, dropout=0, e_layers=2, embed='timeF', enc_in=212, expand=2, factor=1, features='M', freq='h', gap_day=365, gpu=0, inverse=False, is_training=1, itr=1, label_len=48, learning_rate=0.0001, loss='MSE', lradj='type1', mask_rate=0.25, model='Mamba', model_id='pems08_h_96_336', moving_avg=25, n_heads=8, num_kernels=6, num_workers=10, output_attention=False, p_hidden_dims=[128, 128], p_hidden_layers=2, patience=3, pred_len=336, root_path='../../data/pems/', samle_rate=1.0, sample_seed=7, seasonal_patterns='Monthly', seq_len=336, target='OT', task_name='long_term_forecast', top_k=5, train_epochs=10, train_seed=2024, use_amp=False, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
>>>>>>>start training : long_term_forecast_pems08_h_96_336_Mamba_custom_ftM_sl336_ll48_pl336_dm128_nh8_el2_dl1_df16_fc1_ebtimeF_dtTrue_srate1.0_sseed7_trainseed2024_Exp_0>>>>>>>>>>>>>>>>>>>>>>>>>>
train 140801
val 19877
test 40085
	iters: 100, epoch: 1 | loss: 0.3010749
	speed: 0.0442s/iter; left time: 1941.7895s
	iters: 200, epoch: 1 | loss: 0.2375923
	speed: 0.0235s/iter; left time: 1028.0067s
	iters: 300, epoch: 1 | loss: 0.2051442
	speed: 0.0236s/iter; left time: 1030.0973s
	iters: 400, epoch: 1 | loss: 0.1961281
	speed: 0.0235s/iter; left time: 1023.3201s
	iters: 500, epoch: 1 | loss: 0.2108750
	speed: 0.0251s/iter; left time: 1091.6582s
	iters: 600, epoch: 1 | loss: 0.1869701
	speed: 0.0237s/iter; left time: 1028.0544s
	iters: 700, epoch: 1 | loss: 0.2136815
	speed: 0.0236s/iter; left time: 1023.4567s
	iters: 800, epoch: 1 | loss: 0.2092899
	speed: 0.0237s/iter; left time: 1024.0907s
	iters: 900, epoch: 1 | loss: 0.2200068
	speed: 0.0238s/iter; left time: 1026.0206s
	iters: 1000, epoch: 1 | loss: 0.1565579
	speed: 0.0237s/iter; left time: 1019.1472s
	iters: 1100, epoch: 1 | loss: 0.1799051
	speed: 0.0237s/iter; left time: 1016.6701s
	iters: 1200, epoch: 1 | loss: 0.1670779
	speed: 0.0238s/iter; left time: 1017.0542s
	iters: 1300, epoch: 1 | loss: 0.1631924
	speed: 0.0239s/iter; left time: 1018.9322s
	iters: 1400, epoch: 1 | loss: 0.1746925
	speed: 0.0238s/iter; left time: 1013.7652s
	iters: 1500, epoch: 1 | loss: 0.1827716
	speed: 0.0237s/iter; left time: 1007.5178s
	iters: 1600, epoch: 1 | loss: 0.1768863
	speed: 0.0237s/iter; left time: 1003.7795s
	iters: 1700, epoch: 1 | loss: 0.1991527
	speed: 0.0237s/iter; left time: 1000.5664s
	iters: 1800, epoch: 1 | loss: 0.1953992
	speed: 0.0239s/iter; left time: 1006.6619s
	iters: 1900, epoch: 1 | loss: 0.1731425
	speed: 0.0237s/iter; left time: 997.1687s
	iters: 2000, epoch: 1 | loss: 0.1685008
	speed: 0.0237s/iter; left time: 994.9498s
	iters: 2100, epoch: 1 | loss: 0.1615389
	speed: 0.0237s/iter; left time: 993.1880s
	iters: 2200, epoch: 1 | loss: 0.1664978
	speed: 0.0238s/iter; left time: 993.3308s
	iters: 2300, epoch: 1 | loss: 0.1551902
	speed: 0.0239s/iter; left time: 994.5714s
	iters: 2400, epoch: 1 | loss: 0.1599972
	speed: 0.0239s/iter; left time: 994.6499s
	iters: 2500, epoch: 1 | loss: 0.1548535
	speed: 0.0238s/iter; left time: 987.4745s
	iters: 2600, epoch: 1 | loss: 0.1780131
	speed: 0.0238s/iter; left time: 983.9847s
	iters: 2700, epoch: 1 | loss: 0.1837743
	speed: 0.0236s/iter; left time: 974.0250s
	iters: 2800, epoch: 1 | loss: 0.1783507
	speed: 0.0234s/iter; left time: 964.5362s
	iters: 2900, epoch: 1 | loss: 0.1532994
	speed: 0.0235s/iter; left time: 966.8105s
	iters: 3000, epoch: 1 | loss: 0.2242626
	speed: 0.0239s/iter; left time: 981.9340s
	iters: 3100, epoch: 1 | loss: 0.1849895
	speed: 0.0240s/iter; left time: 980.8226s
	iters: 3200, epoch: 1 | loss: 0.1845060
	speed: 0.0237s/iter; left time: 966.0737s
	iters: 3300, epoch: 1 | loss: 0.1692825
	speed: 0.0239s/iter; left time: 972.8008s
	iters: 3400, epoch: 1 | loss: 0.1510825
	speed: 0.0238s/iter; left time: 968.0832s
	iters: 3500, epoch: 1 | loss: 0.1816958
	speed: 0.0253s/iter; left time: 1024.4469s
	iters: 3600, epoch: 1 | loss: 0.1425373
	speed: 0.0245s/iter; left time: 988.6893s
	iters: 3700, epoch: 1 | loss: 0.1631538
	speed: 0.0232s/iter; left time: 935.1184s
	iters: 3800, epoch: 1 | loss: 0.1674843
	speed: 0.0232s/iter; left time: 934.4015s
	iters: 3900, epoch: 1 | loss: 0.1526815
	speed: 0.0233s/iter; left time: 934.8481s
	iters: 4000, epoch: 1 | loss: 0.1606663
	speed: 0.0236s/iter; left time: 943.5436s
	iters: 4100, epoch: 1 | loss: 0.1535015
	speed: 0.0235s/iter; left time: 937.1863s
	iters: 4200, epoch: 1 | loss: 0.1752128
	speed: 0.0235s/iter; left time: 934.1945s
	iters: 4300, epoch: 1 | loss: 0.1740294
	speed: 0.0235s/iter; left time: 932.4909s
	iters: 4400, epoch: 1 | loss: 0.1475792
	speed: 0.0232s/iter; left time: 919.1630s
Epoch: 1 cost time: 106.60495567321777
Epoch: 1, Steps: 4400 | Train Loss: 0.1872949 Vali Loss: 0.2269744 Test Loss: 0.2826318
Validation loss decreased (inf --> 0.226974).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 2 | loss: 0.1632405
	speed: 1.6271s/iter; left time: 64273.7172s
	iters: 200, epoch: 2 | loss: 0.1808753
	speed: 0.0247s/iter; left time: 972.2692s
	iters: 300, epoch: 2 | loss: 0.2109843
	speed: 0.0242s/iter; left time: 950.3597s
	iters: 400, epoch: 2 | loss: 0.1565036
	speed: 0.0233s/iter; left time: 914.2808s
	iters: 500, epoch: 2 | loss: 0.1806173
	speed: 0.0226s/iter; left time: 884.1744s
	iters: 600, epoch: 2 | loss: 0.1933942
	speed: 0.0238s/iter; left time: 928.6396s
	iters: 700, epoch: 2 | loss: 0.1617612
	speed: 0.0231s/iter; left time: 897.1638s
	iters: 800, epoch: 2 | loss: 0.1376194
	speed: 0.0234s/iter; left time: 908.5104s
	iters: 900, epoch: 2 | loss: 0.1827388
	speed: 0.0231s/iter; left time: 894.9663s
	iters: 1000, epoch: 2 | loss: 0.1349684
	speed: 0.0256s/iter; left time: 989.8467s
	iters: 1100, epoch: 2 | loss: 0.1479009
	speed: 0.0245s/iter; left time: 942.6703s
	iters: 1200, epoch: 2 | loss: 0.1607831
	speed: 0.0261s/iter; left time: 1001.5656s
	iters: 1300, epoch: 2 | loss: 0.1948554
	speed: 0.0251s/iter; left time: 963.1671s
	iters: 1400, epoch: 2 | loss: 0.1580793
	speed: 0.0236s/iter; left time: 903.3582s
	iters: 1500, epoch: 2 | loss: 0.1593698
	speed: 0.0263s/iter; left time: 1001.9990s
	iters: 1600, epoch: 2 | loss: 0.1403499
	speed: 0.0260s/iter; left time: 986.3949s
	iters: 1700, epoch: 2 | loss: 0.1751527
	speed: 0.0252s/iter; left time: 955.4072s
	iters: 1800, epoch: 2 | loss: 0.1560583
	speed: 0.0248s/iter; left time: 936.5706s
	iters: 1900, epoch: 2 | loss: 0.1729258
	speed: 0.0261s/iter; left time: 984.8686s
	iters: 2000, epoch: 2 | loss: 0.1738960
	speed: 0.0259s/iter; left time: 972.0740s
	iters: 2100, epoch: 2 | loss: 0.1602931
	speed: 0.0255s/iter; left time: 955.0122s
	iters: 2200, epoch: 2 | loss: 0.1607158
	speed: 0.0247s/iter; left time: 923.7445s
	iters: 2300, epoch: 2 | loss: 0.1718684
	speed: 0.0238s/iter; left time: 886.4532s
	iters: 2400, epoch: 2 | loss: 0.1461248
	speed: 0.0255s/iter; left time: 949.4725s
	iters: 2500, epoch: 2 | loss: 0.1587128
	speed: 0.0243s/iter; left time: 901.2774s
	iters: 2600, epoch: 2 | loss: 0.1611684
	speed: 0.0231s/iter; left time: 855.5398s
	iters: 2700, epoch: 2 | loss: 0.1582701
	speed: 0.0244s/iter; left time: 900.4382s
	iters: 2800, epoch: 2 | loss: 0.1693280
	speed: 0.0258s/iter; left time: 949.7787s
	iters: 2900, epoch: 2 | loss: 0.1575038
	speed: 0.0250s/iter; left time: 916.7856s
	iters: 3000, epoch: 2 | loss: 0.1466153
	speed: 0.0249s/iter; left time: 910.2051s
	iters: 3100, epoch: 2 | loss: 0.1589518
	speed: 0.0247s/iter; left time: 902.2756s
	iters: 3200, epoch: 2 | loss: 0.1758320
	speed: 0.0253s/iter; left time: 919.5569s
	iters: 3300, epoch: 2 | loss: 0.1802329
	speed: 0.0250s/iter; left time: 909.2181s
	iters: 3400, epoch: 2 | loss: 0.1659372
	speed: 0.0255s/iter; left time: 923.2343s
	iters: 3500, epoch: 2 | loss: 0.1454720
	speed: 0.0244s/iter; left time: 881.1955s
	iters: 3600, epoch: 2 | loss: 0.1568842
	speed: 0.0238s/iter; left time: 857.8899s
	iters: 3700, epoch: 2 | loss: 0.1440337
	speed: 0.0236s/iter; left time: 845.8774s
	iters: 3800, epoch: 2 | loss: 0.1598264
	speed: 0.0234s/iter; left time: 836.0450s
	iters: 3900, epoch: 2 | loss: 0.1441183
	speed: 0.0230s/iter; left time: 820.0630s
	iters: 4000, epoch: 2 | loss: 0.1500914
	speed: 0.0235s/iter; left time: 837.0451s
	iters: 4100, epoch: 2 | loss: 0.1561731
	speed: 0.0243s/iter; left time: 862.1969s
	iters: 4200, epoch: 2 | loss: 0.1490628
	speed: 0.0236s/iter; left time: 836.0939s
	iters: 4300, epoch: 2 | loss: 0.1551924
	speed: 0.0238s/iter; left time: 840.3270s
	iters: 4400, epoch: 2 | loss: 0.1566924
	speed: 0.0250s/iter; left time: 878.5596s
Epoch: 2 cost time: 110.77521324157715
Epoch: 2, Steps: 4400 | Train Loss: 0.1581796 Vali Loss: 0.2340331 Test Loss: 0.3027712
EarlyStopping counter: 1 out of 3
Updating learning rate to 5e-05
	iters: 100, epoch: 3 | loss: 0.1469846
	speed: 1.5420s/iter; left time: 54125.4871s
	iters: 200, epoch: 3 | loss: 0.1374772
	speed: 0.0250s/iter; left time: 876.4003s
	iters: 300, epoch: 3 | loss: 0.1501945
	speed: 0.0244s/iter; left time: 850.5832s
	iters: 400, epoch: 3 | loss: 0.1370826
	speed: 0.0246s/iter; left time: 855.5428s
	iters: 500, epoch: 3 | loss: 0.1460390
	speed: 0.0257s/iter; left time: 891.8727s
	iters: 600, epoch: 3 | loss: 0.1372776
	speed: 0.0249s/iter; left time: 862.3739s
	iters: 700, epoch: 3 | loss: 0.1644172
	speed: 0.0231s/iter; left time: 797.6315s
	iters: 800, epoch: 3 | loss: 0.1472129
	speed: 0.0235s/iter; left time: 809.3748s
	iters: 900, epoch: 3 | loss: 0.1528524
	speed: 0.0250s/iter; left time: 858.4015s
	iters: 1000, epoch: 3 | loss: 0.1500404
	speed: 0.0265s/iter; left time: 905.6007s
	iters: 1100, epoch: 3 | loss: 0.1429810
	speed: 0.0270s/iter; left time: 919.3933s
	iters: 1200, epoch: 3 | loss: 0.1363898
	speed: 0.0249s/iter; left time: 847.2299s
	iters: 1300, epoch: 3 | loss: 0.1333671
	speed: 0.0279s/iter; left time: 945.8121s
	iters: 1400, epoch: 3 | loss: 0.1584358
	speed: 0.0268s/iter; left time: 907.3272s
	iters: 1500, epoch: 3 | loss: 0.1401966
	speed: 0.0260s/iter; left time: 874.5969s
	iters: 1600, epoch: 3 | loss: 0.1668320
	speed: 0.0257s/iter; left time: 861.9309s
	iters: 1700, epoch: 3 | loss: 0.1670813
	speed: 0.0258s/iter; left time: 865.9494s
	iters: 1800, epoch: 3 | loss: 0.1494614
	speed: 0.0241s/iter; left time: 803.5587s
	iters: 1900, epoch: 3 | loss: 0.1301190
	speed: 0.0241s/iter; left time: 802.3956s
	iters: 2000, epoch: 3 | loss: 0.1568148
	speed: 0.0266s/iter; left time: 883.0619s
	iters: 2100, epoch: 3 | loss: 0.1350164
	speed: 0.0260s/iter; left time: 860.8638s
	iters: 2200, epoch: 3 | loss: 0.1460768
	speed: 0.0271s/iter; left time: 894.6729s
	iters: 2300, epoch: 3 | loss: 0.1678437
	speed: 0.0261s/iter; left time: 857.6176s
	iters: 2400, epoch: 3 | loss: 0.1671477
	speed: 0.0258s/iter; left time: 845.9716s
	iters: 2500, epoch: 3 | loss: 0.1972668
	speed: 0.0277s/iter; left time: 905.4353s
	iters: 2600, epoch: 3 | loss: 0.1544466
	speed: 0.0252s/iter; left time: 821.3106s
	iters: 2700, epoch: 3 | loss: 0.1279572
	speed: 0.0252s/iter; left time: 818.9562s
	iters: 2800, epoch: 3 | loss: 0.1366690
	speed: 0.0272s/iter; left time: 879.7548s
	iters: 2900, epoch: 3 | loss: 0.1344870
	speed: 0.0241s/iter; left time: 777.7259s
	iters: 3000, epoch: 3 | loss: 0.1383924
	speed: 0.0276s/iter; left time: 888.3677s
	iters: 3100, epoch: 3 | loss: 0.1506244
	speed: 0.0278s/iter; left time: 891.2873s
	iters: 3200, epoch: 3 | loss: 0.1324079
	speed: 0.0281s/iter; left time: 900.3914s
	iters: 3300, epoch: 3 | loss: 0.1467385
	speed: 0.0279s/iter; left time: 890.2769s
	iters: 3400, epoch: 3 | loss: 0.1367610
	speed: 0.0281s/iter; left time: 893.3671s
	iters: 3500, epoch: 3 | loss: 0.1468825
	speed: 0.0280s/iter; left time: 886.9030s
	iters: 3600, epoch: 3 | loss: 0.1353625
	speed: 0.0286s/iter; left time: 903.2935s
	iters: 3700, epoch: 3 | loss: 0.1400003
	speed: 0.0286s/iter; left time: 902.4281s
	iters: 3800, epoch: 3 | loss: 0.1413456
	speed: 0.0288s/iter; left time: 902.9135s
	iters: 3900, epoch: 3 | loss: 0.1401491
	speed: 0.0282s/iter; left time: 883.7504s
	iters: 4000, epoch: 3 | loss: 0.1515199
	speed: 0.0284s/iter; left time: 887.2667s
	iters: 4100, epoch: 3 | loss: 0.1441819
	speed: 0.0287s/iter; left time: 891.6091s
	iters: 4200, epoch: 3 | loss: 0.1430555
	speed: 0.0286s/iter; left time: 886.7561s
	iters: 4300, epoch: 3 | loss: 0.1489122
	speed: 0.0248s/iter; left time: 765.8230s
	iters: 4400, epoch: 3 | loss: 0.1345545
	speed: 0.0233s/iter; left time: 716.7791s
Epoch: 3 cost time: 118.48965883255005
Epoch: 3, Steps: 4400 | Train Loss: 0.1488262 Vali Loss: 0.2362992 Test Loss: 0.3226175
EarlyStopping counter: 2 out of 3
Updating learning rate to 2.5e-05
	iters: 100, epoch: 4 | loss: 0.1500460
	speed: 1.4482s/iter; left time: 44460.6803s
	iters: 200, epoch: 4 | loss: 0.1412489
	speed: 0.0260s/iter; left time: 794.9243s
	iters: 300, epoch: 4 | loss: 0.1529361
	speed: 0.0263s/iter; left time: 802.8112s
	iters: 400, epoch: 4 | loss: 0.1409517
	speed: 0.0247s/iter; left time: 750.4365s
	iters: 500, epoch: 4 | loss: 0.1313248
	speed: 0.0252s/iter; left time: 762.9315s
	iters: 600, epoch: 4 | loss: 0.1829746
	speed: 0.0247s/iter; left time: 744.7210s
	iters: 700, epoch: 4 | loss: 0.1603868
	speed: 0.0256s/iter; left time: 769.2696s
	iters: 800, epoch: 4 | loss: 0.1399913
	speed: 0.0249s/iter; left time: 746.9658s
	iters: 900, epoch: 4 | loss: 0.1345358
	speed: 0.0238s/iter; left time: 711.9477s
	iters: 1000, epoch: 4 | loss: 0.1589678
	speed: 0.0258s/iter; left time: 768.9524s
	iters: 1100, epoch: 4 | loss: 0.1500559
	speed: 0.0243s/iter; left time: 721.9028s
	iters: 1200, epoch: 4 | loss: 0.1569365
	speed: 0.0255s/iter; left time: 755.0815s
	iters: 1300, epoch: 4 | loss: 0.1300755
	speed: 0.0242s/iter; left time: 713.3838s
	iters: 1400, epoch: 4 | loss: 0.1464342
	speed: 0.0254s/iter; left time: 746.0037s
	iters: 1500, epoch: 4 | loss: 0.1434967
	speed: 0.0254s/iter; left time: 745.0253s
	iters: 1600, epoch: 4 | loss: 0.1758013
	speed: 0.0241s/iter; left time: 702.3833s
	iters: 1700, epoch: 4 | loss: 0.1402243
	speed: 0.0259s/iter; left time: 753.1714s
	iters: 1800, epoch: 4 | loss: 0.1677577
	speed: 0.0249s/iter; left time: 721.1426s
	iters: 1900, epoch: 4 | loss: 0.1519259
	speed: 0.0241s/iter; left time: 695.8106s
	iters: 2000, epoch: 4 | loss: 0.1599461
	speed: 0.0236s/iter; left time: 681.0278s
	iters: 2100, epoch: 4 | loss: 0.1895360
	speed: 0.0260s/iter; left time: 746.4503s
	iters: 2200, epoch: 4 | loss: 0.1538317
	speed: 0.0263s/iter; left time: 750.8764s
	iters: 2300, epoch: 4 | loss: 0.1476773
	speed: 0.0251s/iter; left time: 714.3948s
	iters: 2400, epoch: 4 | loss: 0.1282584
	speed: 0.0243s/iter; left time: 689.9813s
	iters: 2500, epoch: 4 | loss: 0.1942770
	speed: 0.0268s/iter; left time: 758.9906s
	iters: 2600, epoch: 4 | loss: 0.1478698
	speed: 0.0245s/iter; left time: 691.0924s
	iters: 2700, epoch: 4 | loss: 0.1514086
	speed: 0.0260s/iter; left time: 730.2481s
	iters: 2800, epoch: 4 | loss: 0.1296612
	speed: 0.0252s/iter; left time: 706.8694s
	iters: 2900, epoch: 4 | loss: 0.1536309
	speed: 0.0248s/iter; left time: 692.4076s
	iters: 3000, epoch: 4 | loss: 0.1386698
	speed: 0.0259s/iter; left time: 720.6866s
	iters: 3100, epoch: 4 | loss: 0.1281509
	speed: 0.0238s/iter; left time: 658.5459s
	iters: 3200, epoch: 4 | loss: 0.1366864
	speed: 0.0262s/iter; left time: 723.2933s
	iters: 3300, epoch: 4 | loss: 0.1514797
	speed: 0.0244s/iter; left time: 671.8477s
	iters: 3400, epoch: 4 | loss: 0.1490593
	speed: 0.0275s/iter; left time: 752.1784s
	iters: 3500, epoch: 4 | loss: 0.1386220
	speed: 0.0240s/iter; left time: 656.4872s
	iters: 3600, epoch: 4 | loss: 0.1464121
	speed: 0.0237s/iter; left time: 643.9205s
	iters: 3700, epoch: 4 | loss: 0.1339373
	speed: 0.0269s/iter; left time: 728.7554s
	iters: 3800, epoch: 4 | loss: 0.1714405
	speed: 0.0268s/iter; left time: 722.9459s
	iters: 3900, epoch: 4 | loss: 0.1453613
	speed: 0.0243s/iter; left time: 654.1549s
	iters: 4000, epoch: 4 | loss: 0.1345330
	speed: 0.0254s/iter; left time: 680.1657s
	iters: 4100, epoch: 4 | loss: 0.1246017
	speed: 0.0258s/iter; left time: 690.1701s
	iters: 4200, epoch: 4 | loss: 0.1426909
	speed: 0.0264s/iter; left time: 702.0567s
	iters: 4300, epoch: 4 | loss: 0.1402780
	speed: 0.0260s/iter; left time: 688.5522s
	iters: 4400, epoch: 4 | loss: 0.1409230
	speed: 0.0274s/iter; left time: 723.6021s
Epoch: 4 cost time: 114.6640076637268
Epoch: 4, Steps: 4400 | Train Loss: 0.1446499 Vali Loss: 0.2405539 Test Loss: 0.3280787
EarlyStopping counter: 3 out of 3
Early stopping
>>>>>>>testing : long_term_forecast_pems08_h_96_336_Mamba_custom_ftM_sl336_ll48_pl336_dm128_nh8_el2_dl1_df16_fc1_ebtimeF_dtTrue_srate1.0_sseed7_trainseed2024_Exp_0<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 40085
test shape: (40085, 1, 336, 212) (40085, 1, 336, 212)
test shape: (40085, 336, 212) (40085, 336, 212)
mse:0.28263264894485474, mae:0.29844388365745544
>>>>>>>Overall time: 1230 seconds<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

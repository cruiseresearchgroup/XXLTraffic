Args in experiment:
Namespace(activation='gelu', anomaly_ratio=0.25, batch_size=32, c_out=822, checkpoints='./checkpoints/', d_conv=4, d_ff=16, d_layers=1, d_model=128, data='custom', data_path='pems04_all_common_flow.csv', dec_in=151, des='Exp', devices='0,1,2,3', distil=True, dropout=0, e_layers=2, embed='timeF', enc_in=822, expand=2, factor=1, features='M', freq='h', gap_day=548, gpu=0, inverse=False, is_training=1, itr=1, label_len=48, learning_rate=0.0001, loss='MSE', lradj='type1', mask_rate=0.25, model='Mamba', model_id='pems04_all_96_336', moving_avg=25, n_heads=8, num_kernels=6, num_workers=10, output_attention=False, p_hidden_dims=[128, 128], p_hidden_layers=2, patience=3, pred_len=336, root_path='../../data/pems/', samle_rate=0.1, sample_seed=7, seasonal_patterns='Monthly', seq_len=336, target='OT', task_name='long_term_forecast', top_k=5, train_epochs=10, train_seed=2024, use_amp=False, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
>>>>>>>start training : long_term_forecast_pems04_all_96_336_Mamba_custom_ftM_sl336_ll48_pl336_dm128_nh8_el2_dl1_df16_fc1_ebtimeF_dtTrue_srate0.1_sseed7_trainseed2024_gap548_Exp_0>>>>>>>>>>>>>>>>>>>>>>>>>>
train 1216160
val 300061
test 300059
	iters: 100, epoch: 1 | loss: 0.8621076
	speed: 0.1596s/iter; left time: 6047.2410s
	iters: 200, epoch: 1 | loss: 0.6209924
	speed: 0.1334s/iter; left time: 5042.9997s
	iters: 300, epoch: 1 | loss: 0.6790223
	speed: 0.1338s/iter; left time: 5045.2746s
	iters: 400, epoch: 1 | loss: 0.6139274
	speed: 0.1338s/iter; left time: 5031.6884s
	iters: 500, epoch: 1 | loss: 0.7133200
	speed: 0.1338s/iter; left time: 5015.7883s
	iters: 600, epoch: 1 | loss: 0.5637357
	speed: 0.1340s/iter; left time: 5012.0281s
	iters: 700, epoch: 1 | loss: 0.5205567
	speed: 0.1342s/iter; left time: 5005.7293s
	iters: 800, epoch: 1 | loss: 0.5246529
	speed: 0.1339s/iter; left time: 4982.7712s
	iters: 900, epoch: 1 | loss: 0.6105921
	speed: 0.1342s/iter; left time: 4977.3063s
	iters: 1000, epoch: 1 | loss: 0.5537442
	speed: 0.1338s/iter; left time: 4949.6775s
	iters: 1100, epoch: 1 | loss: 0.5280102
	speed: 0.1341s/iter; left time: 4946.8249s
	iters: 1200, epoch: 1 | loss: 0.4662893
	speed: 0.1341s/iter; left time: 4934.2038s
	iters: 1300, epoch: 1 | loss: 0.5395977
	speed: 0.1342s/iter; left time: 4924.4493s
	iters: 1400, epoch: 1 | loss: 0.5482446
	speed: 0.1343s/iter; left time: 4915.6266s
	iters: 1500, epoch: 1 | loss: 0.4766710
	speed: 0.1346s/iter; left time: 4912.8055s
	iters: 1600, epoch: 1 | loss: 0.4363766
	speed: 0.1346s/iter; left time: 4897.7916s
	iters: 1700, epoch: 1 | loss: 0.5441943
	speed: 0.1351s/iter; left time: 4902.7701s
	iters: 1800, epoch: 1 | loss: 0.4336290
	speed: 0.1337s/iter; left time: 4838.6956s
	iters: 1900, epoch: 1 | loss: 0.4382939
	speed: 0.1334s/iter; left time: 4815.1244s
	iters: 2000, epoch: 1 | loss: 0.4234793
	speed: 0.1341s/iter; left time: 4826.0919s
	iters: 2100, epoch: 1 | loss: 0.5163672
	speed: 0.1341s/iter; left time: 4815.1179s
	iters: 2200, epoch: 1 | loss: 0.4304670
	speed: 0.1335s/iter; left time: 4779.7333s
	iters: 2300, epoch: 1 | loss: 0.4106244
	speed: 0.1341s/iter; left time: 4789.2134s
	iters: 2400, epoch: 1 | loss: 0.4391319
	speed: 0.1345s/iter; left time: 4788.4447s
	iters: 2500, epoch: 1 | loss: 0.4355615
	speed: 0.1331s/iter; left time: 4726.3671s
	iters: 2600, epoch: 1 | loss: 0.3791829
	speed: 0.1337s/iter; left time: 4733.9465s
	iters: 2700, epoch: 1 | loss: 0.5555028
	speed: 0.1331s/iter; left time: 4697.0065s
	iters: 2800, epoch: 1 | loss: 0.4846697
	speed: 0.1336s/iter; left time: 4701.9452s
	iters: 2900, epoch: 1 | loss: 0.4150336
	speed: 0.1349s/iter; left time: 4736.2761s
	iters: 3000, epoch: 1 | loss: 0.5013753
	speed: 0.1346s/iter; left time: 4711.5394s
	iters: 3100, epoch: 1 | loss: 0.4321390
	speed: 0.1343s/iter; left time: 4686.2212s
	iters: 3200, epoch: 1 | loss: 0.3745545
	speed: 0.1345s/iter; left time: 4681.1297s
	iters: 3300, epoch: 1 | loss: 0.5077047
	speed: 0.1347s/iter; left time: 4673.6808s
	iters: 3400, epoch: 1 | loss: 0.4454623
	speed: 0.1346s/iter; left time: 4657.0418s
	iters: 3500, epoch: 1 | loss: 0.4037649
	speed: 0.1338s/iter; left time: 4615.7388s
	iters: 3600, epoch: 1 | loss: 0.4063679
	speed: 0.1344s/iter; left time: 4624.9025s
	iters: 3700, epoch: 1 | loss: 0.4385836
	speed: 0.1345s/iter; left time: 4614.8573s
	iters: 3800, epoch: 1 | loss: 0.3750935
	speed: 0.1341s/iter; left time: 4585.3443s
Epoch: 1 cost time: 512.3793542385101
Epoch: 1, Steps: 3800 | Train Loss: 0.5201639 Vali Loss: 1.1391255 Test Loss: 0.9605960
Validation loss decreased (inf --> 1.139125).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 2 | loss: 0.5072756
	speed: 3.9529s/iter; left time: 134796.3229s
	iters: 200, epoch: 2 | loss: 0.4067387
	speed: 0.1385s/iter; left time: 4709.2113s
	iters: 300, epoch: 2 | loss: 0.4592370
	speed: 0.1385s/iter; left time: 4695.8769s
	iters: 400, epoch: 2 | loss: 0.4196320
	speed: 0.1388s/iter; left time: 4690.8028s
	iters: 500, epoch: 2 | loss: 0.3561837
	speed: 0.1395s/iter; left time: 4700.1680s
	iters: 600, epoch: 2 | loss: 0.4276471
	speed: 0.1388s/iter; left time: 4664.5972s
	iters: 700, epoch: 2 | loss: 0.4445629
	speed: 0.1385s/iter; left time: 4641.0048s
	iters: 800, epoch: 2 | loss: 0.3869012
	speed: 0.1398s/iter; left time: 4667.9576s
	iters: 900, epoch: 2 | loss: 0.3982249
	speed: 0.1392s/iter; left time: 4636.7160s
	iters: 1000, epoch: 2 | loss: 0.3788072
	speed: 0.1389s/iter; left time: 4610.4345s
	iters: 1100, epoch: 2 | loss: 0.3997408
	speed: 0.1388s/iter; left time: 4595.6417s
	iters: 1200, epoch: 2 | loss: 0.3930648
	speed: 0.1405s/iter; left time: 4637.6803s
	iters: 1300, epoch: 2 | loss: 0.3846233
	speed: 0.1400s/iter; left time: 4605.6621s
	iters: 1400, epoch: 2 | loss: 0.4605438
	speed: 0.1395s/iter; left time: 4575.6630s
	iters: 1500, epoch: 2 | loss: 0.3594907
	speed: 0.1396s/iter; left time: 4566.2756s
	iters: 1600, epoch: 2 | loss: 0.4624857
	speed: 0.1390s/iter; left time: 4532.8835s
	iters: 1700, epoch: 2 | loss: 0.3553098
	speed: 0.1388s/iter; left time: 4509.5510s
	iters: 1800, epoch: 2 | loss: 0.3492253
	speed: 0.1383s/iter; left time: 4479.5494s
	iters: 1900, epoch: 2 | loss: 0.3908672
	speed: 0.1382s/iter; left time: 4463.4485s
	iters: 2000, epoch: 2 | loss: 0.3916722
	speed: 0.1394s/iter; left time: 4487.2174s
	iters: 2100, epoch: 2 | loss: 0.3912630
	speed: 0.1400s/iter; left time: 4493.5214s
	iters: 2200, epoch: 2 | loss: 0.4106551
	speed: 0.1400s/iter; left time: 4480.9522s
	iters: 2300, epoch: 2 | loss: 0.3491280
	speed: 0.1386s/iter; left time: 4421.8805s
	iters: 2400, epoch: 2 | loss: 0.3361589
	speed: 0.1389s/iter; left time: 4417.3806s
	iters: 2500, epoch: 2 | loss: 0.4599892
	speed: 0.1384s/iter; left time: 4386.3381s
	iters: 2600, epoch: 2 | loss: 0.3725098
	speed: 0.1393s/iter; left time: 4402.1091s
	iters: 2700, epoch: 2 | loss: 0.4079211
	speed: 0.1381s/iter; left time: 4351.4462s
	iters: 2800, epoch: 2 | loss: 0.3596377
	speed: 0.1384s/iter; left time: 4345.4070s
	iters: 2900, epoch: 2 | loss: 0.3979425
	speed: 0.1390s/iter; left time: 4349.5200s
	iters: 3000, epoch: 2 | loss: 0.3836504
	speed: 0.1395s/iter; left time: 4353.4161s
	iters: 3100, epoch: 2 | loss: 0.3869440
	speed: 0.1393s/iter; left time: 4331.7820s
	iters: 3200, epoch: 2 | loss: 0.3608485
	speed: 0.1378s/iter; left time: 4272.3252s
	iters: 3300, epoch: 2 | loss: 0.3738290
	speed: 0.1391s/iter; left time: 4299.4699s
	iters: 3400, epoch: 2 | loss: 0.3708303
	speed: 0.1388s/iter; left time: 4276.4322s
	iters: 3500, epoch: 2 | loss: 0.4384314
	speed: 0.1381s/iter; left time: 4238.4714s
	iters: 3600, epoch: 2 | loss: 0.4009858
	speed: 0.1389s/iter; left time: 4251.0483s
	iters: 3700, epoch: 2 | loss: 0.3220209
	speed: 0.1382s/iter; left time: 4215.5069s
	iters: 3800, epoch: 2 | loss: 0.3351691
	speed: 0.1396s/iter; left time: 4242.5233s
Epoch: 2 cost time: 529.3412382602692
Epoch: 2, Steps: 3800 | Train Loss: 0.4047103 Vali Loss: 1.1720613 Test Loss: 1.0205854
EarlyStopping counter: 1 out of 3
Updating learning rate to 5e-05
	iters: 100, epoch: 3 | loss: 0.4018005
	speed: 3.7767s/iter; left time: 114439.2155s
	iters: 200, epoch: 3 | loss: 0.4343284
	speed: 0.1394s/iter; left time: 4209.6403s
	iters: 300, epoch: 3 | loss: 0.3153846
	speed: 0.1393s/iter; left time: 4193.9375s
	iters: 400, epoch: 3 | loss: 0.4511548
	speed: 0.1376s/iter; left time: 4127.8411s
	iters: 500, epoch: 3 | loss: 0.3906540
	speed: 0.1382s/iter; left time: 4130.9889s
	iters: 600, epoch: 3 | loss: 0.3255068
	speed: 0.1380s/iter; left time: 4112.1081s
	iters: 700, epoch: 3 | loss: 0.3495367
	speed: 0.1379s/iter; left time: 4096.9403s
	iters: 800, epoch: 3 | loss: 0.3596977
	speed: 0.1379s/iter; left time: 4081.8384s
	iters: 900, epoch: 3 | loss: 0.4613867
	speed: 0.1380s/iter; left time: 4070.5794s
	iters: 1000, epoch: 3 | loss: 0.4521450
	speed: 0.1382s/iter; left time: 4063.8631s
	iters: 1100, epoch: 3 | loss: 0.3415297
	speed: 0.1386s/iter; left time: 4059.6639s
	iters: 1200, epoch: 3 | loss: 0.3406519
	speed: 0.1381s/iter; left time: 4031.7598s
	iters: 1300, epoch: 3 | loss: 0.3300515
	speed: 0.1395s/iter; left time: 4060.4662s
	iters: 1400, epoch: 3 | loss: 0.3222441
	speed: 0.1387s/iter; left time: 4023.3420s
	iters: 1500, epoch: 3 | loss: 0.3457611
	speed: 0.1393s/iter; left time: 4024.9166s
	iters: 1600, epoch: 3 | loss: 0.3854798
	speed: 0.1396s/iter; left time: 4019.6193s
	iters: 1700, epoch: 3 | loss: 0.3828932
	speed: 0.1381s/iter; left time: 3964.6533s
	iters: 1800, epoch: 3 | loss: 0.3250620
	speed: 0.1387s/iter; left time: 3966.1424s
	iters: 1900, epoch: 3 | loss: 0.3572885
	speed: 0.1382s/iter; left time: 3937.4191s
	iters: 2000, epoch: 3 | loss: 0.3572235
	speed: 0.1389s/iter; left time: 3943.5518s
	iters: 2100, epoch: 3 | loss: 0.3537267
	speed: 0.1381s/iter; left time: 3908.4213s
	iters: 2200, epoch: 3 | loss: 0.3245969
	speed: 0.1380s/iter; left time: 3892.8663s
	iters: 2300, epoch: 3 | loss: 0.4427398
	speed: 0.1383s/iter; left time: 3886.8320s
	iters: 2400, epoch: 3 | loss: 0.3438720
	speed: 0.1373s/iter; left time: 3845.3201s
	iters: 2500, epoch: 3 | loss: 0.3289146
	speed: 0.1388s/iter; left time: 3872.3459s
	iters: 2600, epoch: 3 | loss: 0.3357487
	speed: 0.1381s/iter; left time: 3838.6030s
	iters: 2700, epoch: 3 | loss: 0.3196628
	speed: 0.1388s/iter; left time: 3846.0343s
	iters: 2800, epoch: 3 | loss: 0.3200230
	speed: 0.1392s/iter; left time: 3841.1769s
	iters: 2900, epoch: 3 | loss: 0.3773262
	speed: 0.1386s/iter; left time: 3812.0661s
	iters: 3000, epoch: 3 | loss: 0.4349599
	speed: 0.1384s/iter; left time: 3792.0098s
	iters: 3100, epoch: 3 | loss: 0.3660498
	speed: 0.1387s/iter; left time: 3786.4034s
	iters: 3200, epoch: 3 | loss: 0.3394815
	speed: 0.1392s/iter; left time: 3786.3689s
	iters: 3300, epoch: 3 | loss: 0.3336614
	speed: 0.1397s/iter; left time: 3786.1366s
	iters: 3400, epoch: 3 | loss: 0.3434441
	speed: 0.1402s/iter; left time: 3786.5622s
	iters: 3500, epoch: 3 | loss: 0.3623281
	speed: 0.1400s/iter; left time: 3765.5113s
	iters: 3600, epoch: 3 | loss: 0.3324284
	speed: 0.1395s/iter; left time: 3739.1286s
	iters: 3700, epoch: 3 | loss: 0.3517817
	speed: 0.1396s/iter; left time: 3726.7562s
	iters: 3800, epoch: 3 | loss: 0.3626713
	speed: 0.1395s/iter; left time: 3710.6588s
Epoch: 3 cost time: 528.4642429351807
Epoch: 3, Steps: 3800 | Train Loss: 0.3701940 Vali Loss: 1.1588144 Test Loss: 1.0411593
EarlyStopping counter: 2 out of 3
Updating learning rate to 2.5e-05
	iters: 100, epoch: 4 | loss: 0.3113255
	speed: 3.8557s/iter; left time: 102180.2185s
	iters: 200, epoch: 4 | loss: 0.3531812
	speed: 0.1400s/iter; left time: 3695.7664s
	iters: 300, epoch: 4 | loss: 0.3607223
	speed: 0.1399s/iter; left time: 3678.3749s
	iters: 400, epoch: 4 | loss: 0.3268982
	speed: 0.1398s/iter; left time: 3662.1421s
	iters: 500, epoch: 4 | loss: 0.3015170
	speed: 0.1398s/iter; left time: 3648.7431s
	iters: 600, epoch: 4 | loss: 0.3521191
	speed: 0.1403s/iter; left time: 3646.7152s
	iters: 700, epoch: 4 | loss: 0.3110025
	speed: 0.1375s/iter; left time: 3562.2302s
	iters: 800, epoch: 4 | loss: 0.3375846
	speed: 0.1385s/iter; left time: 3574.5201s
	iters: 900, epoch: 4 | loss: 0.3481342
	speed: 0.1384s/iter; left time: 3556.5349s
	iters: 1000, epoch: 4 | loss: 0.3296208
	speed: 0.1388s/iter; left time: 3554.6880s
	iters: 1100, epoch: 4 | loss: 0.4781670
	speed: 0.1394s/iter; left time: 3553.7933s
	iters: 1200, epoch: 4 | loss: 0.3718012
	speed: 0.1389s/iter; left time: 3529.2446s
	iters: 1300, epoch: 4 | loss: 0.3148854
	speed: 0.1393s/iter; left time: 3523.6072s
	iters: 1400, epoch: 4 | loss: 0.3783713
	speed: 0.1383s/iter; left time: 3485.5372s
	iters: 1500, epoch: 4 | loss: 0.3609444
	speed: 0.1384s/iter; left time: 3472.9106s
	iters: 1600, epoch: 4 | loss: 0.4025651
	speed: 0.1387s/iter; left time: 3466.9484s
	iters: 1700, epoch: 4 | loss: 0.3151056
	speed: 0.1380s/iter; left time: 3436.9793s
	iters: 1800, epoch: 4 | loss: 0.4128299
	speed: 0.1389s/iter; left time: 3444.7922s
	iters: 1900, epoch: 4 | loss: 0.3091181
	speed: 0.1383s/iter; left time: 3417.1128s
	iters: 2000, epoch: 4 | loss: 0.3921199
	speed: 0.1382s/iter; left time: 3399.0413s
	iters: 2100, epoch: 4 | loss: 0.5010889
	speed: 0.1385s/iter; left time: 3393.0363s
	iters: 2200, epoch: 4 | loss: 0.3530466
	speed: 0.1385s/iter; left time: 3380.0495s
	iters: 2300, epoch: 4 | loss: 0.4935428
	speed: 0.1402s/iter; left time: 3408.2120s
	iters: 2400, epoch: 4 | loss: 0.5340304
	speed: 0.1403s/iter; left time: 3394.7515s
	iters: 2500, epoch: 4 | loss: 0.4037965
	speed: 0.1402s/iter; left time: 3378.3884s
	iters: 2600, epoch: 4 | loss: 0.2994734
	speed: 0.1394s/iter; left time: 3346.1128s
	iters: 2700, epoch: 4 | loss: 0.3954444
	speed: 0.1388s/iter; left time: 3317.9813s
	iters: 2800, epoch: 4 | loss: 0.4084005
	speed: 0.1391s/iter; left time: 3309.7839s
	iters: 2900, epoch: 4 | loss: 0.4800646
	speed: 0.1387s/iter; left time: 3287.8345s
	iters: 3000, epoch: 4 | loss: 0.3581226
	speed: 0.1385s/iter; left time: 3269.2858s
	iters: 3100, epoch: 4 | loss: 0.3649586
	speed: 0.1386s/iter; left time: 3257.6273s
	iters: 3200, epoch: 4 | loss: 0.3095388
	speed: 0.1385s/iter; left time: 3240.9013s
	iters: 3300, epoch: 4 | loss: 0.3437189
	speed: 0.1391s/iter; left time: 3241.7921s
	iters: 3400, epoch: 4 | loss: 0.3163861
	speed: 0.1388s/iter; left time: 3219.5387s
	iters: 3500, epoch: 4 | loss: 0.2974120
	speed: 0.1390s/iter; left time: 3210.2881s
	iters: 3600, epoch: 4 | loss: 0.2993241
	speed: 0.1391s/iter; left time: 3198.5511s
	iters: 3700, epoch: 4 | loss: 0.2962403
	speed: 0.1394s/iter; left time: 3193.1023s
	iters: 3800, epoch: 4 | loss: 0.3270067
	speed: 0.1392s/iter; left time: 3174.3637s
Epoch: 4 cost time: 529.7843663692474
Epoch: 4, Steps: 3800 | Train Loss: 0.3562255 Vali Loss: 1.1920617 Test Loss: 1.0380341
EarlyStopping counter: 3 out of 3
Early stopping
>>>>>>>testing : long_term_forecast_pems04_all_96_336_Mamba_custom_ftM_sl336_ll48_pl336_dm128_nh8_el2_dl1_df16_fc1_ebtimeF_dtTrue_srate0.1_sseed7_trainseed2024_gap548_Exp_0<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 300059
test shape: (30005, 1, 336, 822) (30005, 1, 336, 822)
test shape: (30005, 336, 822) (30005, 336, 822)
mse:0.9606317281723022, mae:0.7922684550285339
>>>>>>>Overall time: 4656 seconds<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

Args in experiment:
Namespace(activation='gelu', anomaly_ratio=0.25, batch_size=32, c_out=521, checkpoints='./checkpoints/', d_conv=4, d_ff=16, d_layers=1, d_model=128, data='custom', data_path='pems11_all_common_flow.csv', dec_in=151, des='Exp', devices='0,1,2,3', distil=True, dropout=0, e_layers=2, embed='timeF', enc_in=521, expand=2, factor=1, features='M', freq='h', gap_day=365, gpu=0, inverse=False, is_training=1, itr=1, label_len=48, learning_rate=0.0001, loss='MSE', lradj='type1', mask_rate=0.25, model='Mamba', model_id='pems11_all_96_336', moving_avg=25, n_heads=8, num_kernels=6, num_workers=10, output_attention=False, p_hidden_dims=[128, 128], p_hidden_layers=2, patience=3, pred_len=336, root_path='../../data/pems/', samle_rate=0.1, sample_seed=7, seasonal_patterns='Monthly', seq_len=336, target='OT', task_name='long_term_forecast', top_k=5, train_epochs=10, train_seed=2024, use_amp=False, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
>>>>>>>start training : long_term_forecast_pems11_all_96_336_Mamba_custom_ftM_sl336_ll48_pl336_dm128_nh8_el2_dl1_df16_fc1_ebtimeF_dtTrue_srate0.1_sseed7_trainseed2024_gap365_Exp_0>>>>>>>>>>>>>>>>>>>>>>>>>>
train 1253320
val 347582
test 347582
	iters: 100, epoch: 1 | loss: 0.5726799
	speed: 0.1226s/iter; left time: 4788.6216s
	iters: 200, epoch: 1 | loss: 0.5580203
	speed: 0.0982s/iter; left time: 3824.6222s
	iters: 300, epoch: 1 | loss: 0.5921346
	speed: 0.0987s/iter; left time: 3833.6933s
	iters: 400, epoch: 1 | loss: 0.7308637
	speed: 0.0981s/iter; left time: 3800.8660s
	iters: 500, epoch: 1 | loss: 0.5309440
	speed: 0.0981s/iter; left time: 3793.1925s
	iters: 600, epoch: 1 | loss: 0.4998262
	speed: 0.0980s/iter; left time: 3778.4698s
	iters: 700, epoch: 1 | loss: 0.6650141
	speed: 0.1053s/iter; left time: 4049.2933s
	iters: 800, epoch: 1 | loss: 0.5215011
	speed: 0.1062s/iter; left time: 4075.2663s
	iters: 900, epoch: 1 | loss: 0.4048500
	speed: 0.1082s/iter; left time: 4140.0961s
	iters: 1000, epoch: 1 | loss: 0.4417911
	speed: 0.1073s/iter; left time: 4095.9825s
	iters: 1100, epoch: 1 | loss: 0.5581998
	speed: 0.1065s/iter; left time: 4052.3246s
	iters: 1200, epoch: 1 | loss: 0.4419045
	speed: 0.1016s/iter; left time: 3856.3032s
	iters: 1300, epoch: 1 | loss: 0.4396120
	speed: 0.1001s/iter; left time: 3789.2648s
	iters: 1400, epoch: 1 | loss: 0.6011973
	speed: 0.1002s/iter; left time: 3785.0010s
	iters: 1500, epoch: 1 | loss: 0.4420652
	speed: 0.1002s/iter; left time: 3773.5946s
	iters: 1600, epoch: 1 | loss: 0.5283362
	speed: 0.1014s/iter; left time: 3808.7412s
	iters: 1700, epoch: 1 | loss: 0.4852192
	speed: 0.1019s/iter; left time: 3817.9637s
	iters: 1800, epoch: 1 | loss: 0.5025970
	speed: 0.1081s/iter; left time: 4039.0075s
	iters: 1900, epoch: 1 | loss: 0.3738065
	speed: 0.1079s/iter; left time: 4020.6006s
	iters: 2000, epoch: 1 | loss: 0.4058502
	speed: 0.1055s/iter; left time: 3921.4473s
	iters: 2100, epoch: 1 | loss: 0.4477572
	speed: 0.1072s/iter; left time: 3973.1330s
	iters: 2200, epoch: 1 | loss: 0.3927690
	speed: 0.1056s/iter; left time: 3902.0557s
	iters: 2300, epoch: 1 | loss: 0.4965397
	speed: 0.1064s/iter; left time: 3921.4312s
	iters: 2400, epoch: 1 | loss: 0.4589878
	speed: 0.1078s/iter; left time: 3961.1830s
	iters: 2500, epoch: 1 | loss: 0.4989545
	speed: 0.1067s/iter; left time: 3910.6668s
	iters: 2600, epoch: 1 | loss: 0.3763353
	speed: 0.1001s/iter; left time: 3659.0501s
	iters: 2700, epoch: 1 | loss: 0.3764470
	speed: 0.0954s/iter; left time: 3479.9336s
	iters: 2800, epoch: 1 | loss: 0.4226109
	speed: 0.0965s/iter; left time: 3507.5682s
	iters: 2900, epoch: 1 | loss: 0.3706348
	speed: 0.0946s/iter; left time: 3429.4246s
	iters: 3000, epoch: 1 | loss: 0.4174066
	speed: 0.0942s/iter; left time: 3407.0666s
	iters: 3100, epoch: 1 | loss: 0.4037501
	speed: 0.0942s/iter; left time: 3396.7597s
	iters: 3200, epoch: 1 | loss: 0.4801236
	speed: 0.0958s/iter; left time: 3443.6428s
	iters: 3300, epoch: 1 | loss: 0.4919294
	speed: 0.0965s/iter; left time: 3460.9803s
	iters: 3400, epoch: 1 | loss: 0.4406234
	speed: 0.1036s/iter; left time: 3704.1880s
	iters: 3500, epoch: 1 | loss: 0.5222260
	speed: 0.1063s/iter; left time: 3791.1526s
	iters: 3600, epoch: 1 | loss: 0.4576101
	speed: 0.1103s/iter; left time: 3921.6931s
	iters: 3700, epoch: 1 | loss: 0.4161663
	speed: 0.1088s/iter; left time: 3858.3013s
	iters: 3800, epoch: 1 | loss: 0.5338095
	speed: 0.1101s/iter; left time: 3893.5219s
	iters: 3900, epoch: 1 | loss: 0.4898487
	speed: 0.1083s/iter; left time: 3819.2809s
Epoch: 1 cost time: 404.20234966278076
Epoch: 1, Steps: 3916 | Train Loss: 0.4960721 Vali Loss: 1.1736662 Test Loss: 5.2509422
Validation loss decreased (inf --> 1.173666).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 2 | loss: 0.4090577
	speed: 3.2807s/iter; left time: 115301.0577s
	iters: 200, epoch: 2 | loss: 0.4145916
	speed: 0.1066s/iter; left time: 3736.4620s
	iters: 300, epoch: 2 | loss: 0.4277198
	speed: 0.1053s/iter; left time: 3680.6806s
	iters: 400, epoch: 2 | loss: 0.5190231
	speed: 0.1002s/iter; left time: 3491.5939s
	iters: 500, epoch: 2 | loss: 0.3741076
	speed: 0.1023s/iter; left time: 3554.8895s
	iters: 600, epoch: 2 | loss: 0.4175166
	speed: 0.1036s/iter; left time: 3588.1640s
	iters: 700, epoch: 2 | loss: 0.3765893
	speed: 0.1059s/iter; left time: 3659.2923s
	iters: 800, epoch: 2 | loss: 0.3560926
	speed: 0.1089s/iter; left time: 3749.4431s
	iters: 900, epoch: 2 | loss: 0.3913061
	speed: 0.1065s/iter; left time: 3659.2712s
	iters: 1000, epoch: 2 | loss: 0.3821109
	speed: 0.1049s/iter; left time: 3591.2436s
	iters: 1100, epoch: 2 | loss: 0.4357864
	speed: 0.1086s/iter; left time: 3707.5135s
	iters: 1200, epoch: 2 | loss: 0.3883633
	speed: 0.1057s/iter; left time: 3598.3814s
	iters: 1300, epoch: 2 | loss: 0.4455031
	speed: 0.1087s/iter; left time: 3689.2717s
	iters: 1400, epoch: 2 | loss: 0.3991190
	speed: 0.0995s/iter; left time: 3366.2793s
	iters: 1500, epoch: 2 | loss: 0.3999795
	speed: 0.0992s/iter; left time: 3347.7385s
	iters: 1600, epoch: 2 | loss: 0.3653607
	speed: 0.1060s/iter; left time: 3566.6260s
	iters: 1700, epoch: 2 | loss: 0.5079678
	speed: 0.1088s/iter; left time: 3648.2277s
	iters: 1800, epoch: 2 | loss: 0.4982070
	speed: 0.1086s/iter; left time: 3633.5179s
	iters: 1900, epoch: 2 | loss: 0.4543759
	speed: 0.1024s/iter; left time: 3413.8418s
	iters: 2000, epoch: 2 | loss: 0.4911627
	speed: 0.1018s/iter; left time: 3384.9073s
	iters: 2100, epoch: 2 | loss: 0.3789071
	speed: 0.1035s/iter; left time: 3431.3031s
	iters: 2200, epoch: 2 | loss: 0.4570608
	speed: 0.1104s/iter; left time: 3647.9181s
	iters: 2300, epoch: 2 | loss: 0.3100160
	speed: 0.1085s/iter; left time: 3575.9300s
	iters: 2400, epoch: 2 | loss: 0.4125641
	speed: 0.1090s/iter; left time: 3580.8731s
	iters: 2500, epoch: 2 | loss: 0.4952610
	speed: 0.1084s/iter; left time: 3549.8878s
	iters: 2600, epoch: 2 | loss: 0.4349686
	speed: 0.1043s/iter; left time: 3403.3024s
	iters: 2700, epoch: 2 | loss: 0.4790204
	speed: 0.1096s/iter; left time: 3565.7555s
	iters: 2800, epoch: 2 | loss: 0.3595551
	speed: 0.1106s/iter; left time: 3588.1127s
	iters: 2900, epoch: 2 | loss: 0.4503144
	speed: 0.1110s/iter; left time: 3589.8793s
	iters: 3000, epoch: 2 | loss: 0.3753993
	speed: 0.1091s/iter; left time: 3518.9111s
	iters: 3100, epoch: 2 | loss: 0.3968627
	speed: 0.1082s/iter; left time: 3477.0096s
	iters: 3200, epoch: 2 | loss: 0.3537533
	speed: 0.1090s/iter; left time: 3493.7707s
	iters: 3300, epoch: 2 | loss: 0.3730058
	speed: 0.1076s/iter; left time: 3437.4445s
	iters: 3400, epoch: 2 | loss: 0.4060988
	speed: 0.1084s/iter; left time: 3451.1734s
	iters: 3500, epoch: 2 | loss: 0.5167139
	speed: 0.1092s/iter; left time: 3465.1733s
	iters: 3600, epoch: 2 | loss: 0.3880682
	speed: 0.1116s/iter; left time: 3530.1827s
	iters: 3700, epoch: 2 | loss: 0.6730071
	speed: 0.1070s/iter; left time: 3375.8009s
	iters: 3800, epoch: 2 | loss: 0.3411923
	speed: 0.1078s/iter; left time: 3390.7203s
	iters: 3900, epoch: 2 | loss: 0.4195308
	speed: 0.1097s/iter; left time: 3437.5700s
Epoch: 2 cost time: 419.2529661655426
Epoch: 2, Steps: 3916 | Train Loss: 0.4182520 Vali Loss: 1.1800528 Test Loss: 5.2266302
EarlyStopping counter: 1 out of 3
Updating learning rate to 5e-05
	iters: 100, epoch: 3 | loss: 0.4111653
	speed: 3.0298s/iter; left time: 94617.9644s
	iters: 200, epoch: 3 | loss: 0.4058824
	speed: 0.1013s/iter; left time: 3153.5240s
	iters: 300, epoch: 3 | loss: 0.3518742
	speed: 0.1016s/iter; left time: 3153.6924s
	iters: 400, epoch: 3 | loss: 0.4284723
	speed: 0.1017s/iter; left time: 3145.5793s
	iters: 500, epoch: 3 | loss: 0.4405675
	speed: 0.1021s/iter; left time: 3148.5817s
	iters: 600, epoch: 3 | loss: 0.3220733
	speed: 0.1063s/iter; left time: 3267.3294s
	iters: 700, epoch: 3 | loss: 0.3522693
	speed: 0.1068s/iter; left time: 3271.2570s
	iters: 800, epoch: 3 | loss: 0.3691832
	speed: 0.1036s/iter; left time: 3161.7722s
	iters: 900, epoch: 3 | loss: 0.4169118
	speed: 0.1043s/iter; left time: 3174.7708s
	iters: 1000, epoch: 3 | loss: 0.3991480
	speed: 0.1049s/iter; left time: 3182.5775s
	iters: 1100, epoch: 3 | loss: 0.4222815
	speed: 0.1043s/iter; left time: 3153.3137s
	iters: 1200, epoch: 3 | loss: 0.3109611
	speed: 0.1021s/iter; left time: 3075.0982s
	iters: 1300, epoch: 3 | loss: 0.5300106
	speed: 0.1013s/iter; left time: 3040.7670s
	iters: 1400, epoch: 3 | loss: 0.3259403
	speed: 0.1012s/iter; left time: 3029.3329s
	iters: 1500, epoch: 3 | loss: 0.3533388
	speed: 0.1012s/iter; left time: 3018.1974s
	iters: 1600, epoch: 3 | loss: 0.3747455
	speed: 0.1013s/iter; left time: 3010.1163s
	iters: 1700, epoch: 3 | loss: 0.3123789
	speed: 0.1026s/iter; left time: 3038.4681s
	iters: 1800, epoch: 3 | loss: 0.4426763
	speed: 0.1066s/iter; left time: 3148.4210s
	iters: 1900, epoch: 3 | loss: 0.4539739
	speed: 0.1068s/iter; left time: 3141.7890s
	iters: 2000, epoch: 3 | loss: 0.4882631
	speed: 0.1067s/iter; left time: 3129.4249s
	iters: 2100, epoch: 3 | loss: 0.4548948
	speed: 0.1065s/iter; left time: 3112.1949s
	iters: 2200, epoch: 3 | loss: 0.4278709
	speed: 0.1068s/iter; left time: 3110.0656s
	iters: 2300, epoch: 3 | loss: 0.3732109
	speed: 0.1070s/iter; left time: 3104.7259s
	iters: 2400, epoch: 3 | loss: 0.3938369
	speed: 0.1038s/iter; left time: 3001.8876s
	iters: 2500, epoch: 3 | loss: 0.3859828
	speed: 0.1047s/iter; left time: 3019.4046s
	iters: 2600, epoch: 3 | loss: 0.4177621
	speed: 0.1036s/iter; left time: 2976.1653s
	iters: 2700, epoch: 3 | loss: 0.3706435
	speed: 0.1069s/iter; left time: 3059.7945s
	iters: 2800, epoch: 3 | loss: 0.4146605
	speed: 0.1076s/iter; left time: 3070.6435s
	iters: 2900, epoch: 3 | loss: 0.4250993
	speed: 0.1047s/iter; left time: 2976.7523s
	iters: 3000, epoch: 3 | loss: 0.4550777
	speed: 0.1029s/iter; left time: 2914.2545s
	iters: 3100, epoch: 3 | loss: 0.4175462
	speed: 0.1000s/iter; left time: 2823.6823s
	iters: 3200, epoch: 3 | loss: 0.3101516
	speed: 0.1084s/iter; left time: 3050.4119s
	iters: 3300, epoch: 3 | loss: 0.4498215
	speed: 0.1098s/iter; left time: 3078.6734s
	iters: 3400, epoch: 3 | loss: 0.4003429
	speed: 0.1026s/iter; left time: 2865.5386s
	iters: 3500, epoch: 3 | loss: 0.4127533
	speed: 0.1046s/iter; left time: 2910.6492s
	iters: 3600, epoch: 3 | loss: 0.3867169
	speed: 0.1110s/iter; left time: 3077.6512s
	iters: 3700, epoch: 3 | loss: 0.5167391
	speed: 0.1129s/iter; left time: 3119.9211s
	iters: 3800, epoch: 3 | loss: 0.3598425
	speed: 0.1109s/iter; left time: 3052.9960s
	iters: 3900, epoch: 3 | loss: 0.5254573
	speed: 0.1088s/iter; left time: 2983.6984s
Epoch: 3 cost time: 412.3646776676178
Epoch: 3, Steps: 3916 | Train Loss: 0.3965867 Vali Loss: 1.1893091 Test Loss: 5.2860074
EarlyStopping counter: 2 out of 3
Updating learning rate to 2.5e-05
	iters: 100, epoch: 4 | loss: 0.3655376
	speed: 2.5747s/iter; left time: 70322.4973s
	iters: 200, epoch: 4 | loss: 0.4873994
	speed: 0.1071s/iter; left time: 2914.3766s
	iters: 300, epoch: 4 | loss: 0.2959448
	speed: 0.1049s/iter; left time: 2843.2192s
	iters: 400, epoch: 4 | loss: 0.4096206
	speed: 0.1033s/iter; left time: 2790.8222s
	iters: 500, epoch: 4 | loss: 0.3702009
	speed: 0.1044s/iter; left time: 2810.4923s
	iters: 600, epoch: 4 | loss: 0.3702182
	speed: 0.1031s/iter; left time: 2764.5872s
	iters: 700, epoch: 4 | loss: 0.4689287
	speed: 0.1077s/iter; left time: 2877.4995s
	iters: 800, epoch: 4 | loss: 0.3218075
	speed: 0.1085s/iter; left time: 2887.1042s
	iters: 900, epoch: 4 | loss: 0.3491922
	speed: 0.1067s/iter; left time: 2829.6739s
	iters: 1000, epoch: 4 | loss: 0.3103219
	speed: 0.1076s/iter; left time: 2841.6738s
	iters: 1100, epoch: 4 | loss: 0.3040565
	speed: 0.1079s/iter; left time: 2838.8199s
	iters: 1200, epoch: 4 | loss: 0.2676243
	speed: 0.1078s/iter; left time: 2825.7684s
	iters: 1300, epoch: 4 | loss: 0.4020174
	speed: 0.1074s/iter; left time: 2803.6507s
	iters: 1400, epoch: 4 | loss: 0.3793983
	speed: 0.1086s/iter; left time: 2826.1861s
	iters: 1500, epoch: 4 | loss: 0.3032522
	speed: 0.1082s/iter; left time: 2803.2356s
	iters: 1600, epoch: 4 | loss: 0.2869332
	speed: 0.1087s/iter; left time: 2805.8463s
	iters: 1700, epoch: 4 | loss: 0.3693257
	speed: 0.1077s/iter; left time: 2769.0262s
	iters: 1800, epoch: 4 | loss: 0.4172637
	speed: 0.1097s/iter; left time: 2808.5759s
	iters: 1900, epoch: 4 | loss: 0.3421234
	speed: 0.1084s/iter; left time: 2766.4395s
	iters: 2000, epoch: 4 | loss: 0.3832877
	speed: 0.1091s/iter; left time: 2772.0193s
	iters: 2100, epoch: 4 | loss: 0.3985753
	speed: 0.1087s/iter; left time: 2751.4181s
	iters: 2200, epoch: 4 | loss: 0.3306523
	speed: 0.1082s/iter; left time: 2727.0672s
	iters: 2300, epoch: 4 | loss: 0.4334705
	speed: 0.1082s/iter; left time: 2716.8314s
	iters: 2400, epoch: 4 | loss: 0.4035342
	speed: 0.1089s/iter; left time: 2722.8084s
	iters: 2500, epoch: 4 | loss: 0.3689235
	speed: 0.1099s/iter; left time: 2737.3647s
	iters: 2600, epoch: 4 | loss: 0.3888673
	speed: 0.1084s/iter; left time: 2690.4246s
	iters: 2700, epoch: 4 | loss: 0.4016792
	speed: 0.1090s/iter; left time: 2692.9801s
	iters: 2800, epoch: 4 | loss: 0.4256175
	speed: 0.1072s/iter; left time: 2638.9521s
	iters: 2900, epoch: 4 | loss: 0.3696793
	speed: 0.1071s/iter; left time: 2626.4802s
	iters: 3000, epoch: 4 | loss: 0.3700520
	speed: 0.1075s/iter; left time: 2625.4678s
	iters: 3100, epoch: 4 | loss: 0.2971404
	speed: 0.1092s/iter; left time: 2654.9904s
	iters: 3200, epoch: 4 | loss: 0.3806718
	speed: 0.1092s/iter; left time: 2642.9742s
	iters: 3300, epoch: 4 | loss: 0.3444267
	speed: 0.1079s/iter; left time: 2602.9813s
	iters: 3400, epoch: 4 | loss: 0.3294261
	speed: 0.1087s/iter; left time: 2610.3559s
	iters: 3500, epoch: 4 | loss: 0.4092134
	speed: 0.1074s/iter; left time: 2568.9611s
	iters: 3600, epoch: 4 | loss: 0.4832428
	speed: 0.1067s/iter; left time: 2541.1527s
	iters: 3700, epoch: 4 | loss: 0.4392281
	speed: 0.1087s/iter; left time: 2578.6011s
	iters: 3800, epoch: 4 | loss: 0.3083134
	speed: 0.1087s/iter; left time: 2566.0151s
	iters: 3900, epoch: 4 | loss: 0.3465289
	speed: 0.1076s/iter; left time: 2529.8027s
Epoch: 4 cost time: 423.1920442581177
Epoch: 4, Steps: 3916 | Train Loss: 0.3879865 Vali Loss: 1.1945704 Test Loss: 5.2605858
EarlyStopping counter: 3 out of 3
Early stopping
>>>>>>>testing : long_term_forecast_pems11_all_96_336_Mamba_custom_ftM_sl336_ll48_pl336_dm128_nh8_el2_dl1_df16_fc1_ebtimeF_dtTrue_srate0.1_sseed7_trainseed2024_gap365_Exp_0<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 347582
test shape: (34758, 1, 336, 521) (34758, 1, 336, 521)
test shape: (34758, 336, 521) (34758, 336, 521)
mse:5.25109338760376, mae:0.901504397392273
>>>>>>>Overall time: 3636 seconds<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

Args in experiment:
Namespace(activation='gelu', anomaly_ratio=0.25, batch_size=32, c_out=1613, checkpoints='./checkpoints/', d_conv=4, d_ff=16, d_layers=1, d_model=128, data='custom', data_path='pems07_all_filter10.csv', dec_in=151, des='Exp', devices='0,1,2,3', distil=True, dropout=0, e_layers=2, embed='timeF', enc_in=1613, expand=2, factor=1, features='M', freq='h', gap_day=548, gpu=0, inverse=False, is_training=1, itr=1, label_len=48, learning_rate=0.0001, loss='MSE', lradj='type1', mask_rate=0.25, model='Mamba', model_id='pems07_all_96_336', moving_avg=25, n_heads=8, num_kernels=6, num_workers=10, output_attention=False, p_hidden_dims=[128, 128], p_hidden_layers=2, patience=3, pred_len=336, root_path='../../data/pems/', samle_rate=0.1, sample_seed=7, seasonal_patterns='Monthly', seq_len=336, target='OT', task_name='long_term_forecast', top_k=5, train_epochs=10, train_seed=2024, use_amp=False, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
>>>>>>>start training : long_term_forecast_pems07_all_96_336_Mamba_custom_ftM_sl336_ll48_pl336_dm128_nh8_el2_dl1_df16_fc1_ebtimeF_dtTrue_srate0.1_sseed7_trainseed2024_gap548_Exp_0>>>>>>>>>>>>>>>>>>>>>>>>>>
train 1216273
val 300097
test 300097
	iters: 100, epoch: 1 | loss: 0.6604296
	speed: 0.2841s/iter; left time: 10768.3006s
	iters: 200, epoch: 1 | loss: 0.5191029
	speed: 0.2458s/iter; left time: 9292.8741s
	iters: 300, epoch: 1 | loss: 0.5004205
	speed: 0.2463s/iter; left time: 9286.6018s
	iters: 400, epoch: 1 | loss: 0.4881879
	speed: 0.2465s/iter; left time: 9269.1701s
	iters: 500, epoch: 1 | loss: 0.4482343
	speed: 0.2469s/iter; left time: 9259.2546s
	iters: 600, epoch: 1 | loss: 0.4171408
	speed: 0.2470s/iter; left time: 9236.3115s
	iters: 700, epoch: 1 | loss: 0.4526761
	speed: 0.2470s/iter; left time: 9213.7792s
	iters: 800, epoch: 1 | loss: 0.4431562
	speed: 0.2475s/iter; left time: 9206.3534s
	iters: 900, epoch: 1 | loss: 0.3956653
	speed: 0.2473s/iter; left time: 9174.1958s
	iters: 1000, epoch: 1 | loss: 0.4311766
	speed: 0.2475s/iter; left time: 9156.1108s
	iters: 1100, epoch: 1 | loss: 0.3971224
	speed: 0.2475s/iter; left time: 9131.9243s
	iters: 1200, epoch: 1 | loss: 0.4354913
	speed: 0.2466s/iter; left time: 9076.3539s
	iters: 1300, epoch: 1 | loss: 0.4462808
	speed: 0.2466s/iter; left time: 9050.2649s
	iters: 1400, epoch: 1 | loss: 0.3870404
	speed: 0.2458s/iter; left time: 8996.0610s
	iters: 1500, epoch: 1 | loss: 0.4149404
	speed: 0.2471s/iter; left time: 9018.8687s
	iters: 1600, epoch: 1 | loss: 0.4299325
	speed: 0.2464s/iter; left time: 8968.2065s
	iters: 1700, epoch: 1 | loss: 0.4062601
	speed: 0.2466s/iter; left time: 8951.2403s
	iters: 1800, epoch: 1 | loss: 0.3785635
	speed: 0.2461s/iter; left time: 8907.3907s
	iters: 1900, epoch: 1 | loss: 0.3991126
	speed: 0.2459s/iter; left time: 8877.5854s
	iters: 2000, epoch: 1 | loss: 0.3871812
	speed: 0.2472s/iter; left time: 8899.7511s
	iters: 2100, epoch: 1 | loss: 0.4097995
	speed: 0.2476s/iter; left time: 8888.2995s
	iters: 2200, epoch: 1 | loss: 0.4177136
	speed: 0.2479s/iter; left time: 8874.0515s
	iters: 2300, epoch: 1 | loss: 0.3591538
	speed: 0.2467s/iter; left time: 8807.9771s
	iters: 2400, epoch: 1 | loss: 0.3689338
	speed: 0.2465s/iter; left time: 8774.4914s
	iters: 2500, epoch: 1 | loss: 0.3955498
	speed: 0.2450s/iter; left time: 8696.6927s
	iters: 2600, epoch: 1 | loss: 0.3852670
	speed: 0.2467s/iter; left time: 8732.4982s
	iters: 2700, epoch: 1 | loss: 0.4010336
	speed: 0.2476s/iter; left time: 8739.6424s
	iters: 2800, epoch: 1 | loss: 0.3847049
	speed: 0.2463s/iter; left time: 8668.8435s
	iters: 2900, epoch: 1 | loss: 0.3671561
	speed: 0.2464s/iter; left time: 8647.3721s
	iters: 3000, epoch: 1 | loss: 0.3841684
	speed: 0.2476s/iter; left time: 8666.8057s
	iters: 3100, epoch: 1 | loss: 0.3516933
	speed: 0.2477s/iter; left time: 8643.9966s
	iters: 3200, epoch: 1 | loss: 0.3779920
	speed: 0.2479s/iter; left time: 8626.0073s
	iters: 3300, epoch: 1 | loss: 0.3804718
	speed: 0.2466s/iter; left time: 8556.3480s
	iters: 3400, epoch: 1 | loss: 0.3542811
	speed: 0.2472s/iter; left time: 8552.5744s
	iters: 3500, epoch: 1 | loss: 0.3638926
	speed: 0.2474s/iter; left time: 8536.9418s
	iters: 3600, epoch: 1 | loss: 0.3623289
	speed: 0.2462s/iter; left time: 8470.7258s
	iters: 3700, epoch: 1 | loss: 0.3335062
	speed: 0.2469s/iter; left time: 8469.8408s
	iters: 3800, epoch: 1 | loss: 0.3713657
	speed: 0.2478s/iter; left time: 8475.9630s
Epoch: 1 cost time: 942.1543097496033
Epoch: 1, Steps: 3800 | Train Loss: 0.4241014 Vali Loss: 0.9604508 Test Loss: 1.6825312
Validation loss decreased (inf --> 0.960451).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 2 | loss: 0.3647199
	speed: 6.4712s/iter; left time: 220675.1678s
	iters: 200, epoch: 2 | loss: 0.3507060
	speed: 0.2492s/iter; left time: 8472.3697s
	iters: 300, epoch: 2 | loss: 0.4013144
	speed: 0.2482s/iter; left time: 8415.0776s
	iters: 400, epoch: 2 | loss: 0.3240542
	speed: 0.2494s/iter; left time: 8429.5498s
	iters: 500, epoch: 2 | loss: 0.3395956
	speed: 0.2478s/iter; left time: 8352.5706s
	iters: 600, epoch: 2 | loss: 0.3384668
	speed: 0.2480s/iter; left time: 8333.5262s
	iters: 700, epoch: 2 | loss: 0.3603027
	speed: 0.2495s/iter; left time: 8359.8030s
	iters: 800, epoch: 2 | loss: 0.3526426
	speed: 0.2487s/iter; left time: 8306.7234s
	iters: 900, epoch: 2 | loss: 0.3627014
	speed: 0.2511s/iter; left time: 8363.3918s
	iters: 1000, epoch: 2 | loss: 0.3340675
	speed: 0.2545s/iter; left time: 8448.1941s
	iters: 1100, epoch: 2 | loss: 0.3345665
	speed: 0.2550s/iter; left time: 8441.8507s
	iters: 1200, epoch: 2 | loss: 0.3576876
	speed: 0.2537s/iter; left time: 8372.7719s
	iters: 1300, epoch: 2 | loss: 0.3225085
	speed: 0.2469s/iter; left time: 8124.6046s
	iters: 1400, epoch: 2 | loss: 0.3447604
	speed: 0.2457s/iter; left time: 8059.2252s
	iters: 1500, epoch: 2 | loss: 0.3257023
	speed: 0.2496s/iter; left time: 8161.6428s
	iters: 1600, epoch: 2 | loss: 0.3378212
	speed: 0.2483s/iter; left time: 8094.3430s
	iters: 1700, epoch: 2 | loss: 0.3123612
	speed: 0.2477s/iter; left time: 8049.4329s
	iters: 1800, epoch: 2 | loss: 0.3701069
	speed: 0.2499s/iter; left time: 8095.4331s
	iters: 1900, epoch: 2 | loss: 0.3184872
	speed: 0.2479s/iter; left time: 8008.8303s
	iters: 2000, epoch: 2 | loss: 0.3228851
	speed: 0.2500s/iter; left time: 8048.6975s
	iters: 2100, epoch: 2 | loss: 0.3330978
	speed: 0.2487s/iter; left time: 7982.7035s
	iters: 2200, epoch: 2 | loss: 0.3293597
	speed: 0.2494s/iter; left time: 7980.6338s
	iters: 2300, epoch: 2 | loss: 0.3332110
	speed: 0.2481s/iter; left time: 7913.5960s
	iters: 2400, epoch: 2 | loss: 0.3262753
	speed: 0.2500s/iter; left time: 7951.0906s
	iters: 2500, epoch: 2 | loss: 0.3308065
	speed: 0.2479s/iter; left time: 7858.7397s
	iters: 2600, epoch: 2 | loss: 0.3131392
	speed: 0.2500s/iter; left time: 7901.3112s
	iters: 2700, epoch: 2 | loss: 0.3138174
	speed: 0.2473s/iter; left time: 7791.2723s
	iters: 2800, epoch: 2 | loss: 0.3248935
	speed: 0.2482s/iter; left time: 7793.2296s
	iters: 2900, epoch: 2 | loss: 0.3128238
	speed: 0.2486s/iter; left time: 7780.8288s
	iters: 3000, epoch: 2 | loss: 0.3038488
	speed: 0.2486s/iter; left time: 7756.8389s
	iters: 3100, epoch: 2 | loss: 0.3121710
	speed: 0.2482s/iter; left time: 7719.9600s
	iters: 3200, epoch: 2 | loss: 0.2973167
	speed: 0.2489s/iter; left time: 7715.2344s
	iters: 3300, epoch: 2 | loss: 0.2927645
	speed: 0.2500s/iter; left time: 7724.7318s
	iters: 3400, epoch: 2 | loss: 0.3372553
	speed: 0.2539s/iter; left time: 7820.2520s
	iters: 3500, epoch: 2 | loss: 0.3422411
	speed: 0.2549s/iter; left time: 7825.9139s
	iters: 3600, epoch: 2 | loss: 0.3062949
	speed: 0.2544s/iter; left time: 7785.5073s
	iters: 3700, epoch: 2 | loss: 0.3416602
	speed: 0.2543s/iter; left time: 7756.1933s
	iters: 3800, epoch: 2 | loss: 0.3300474
	speed: 0.2503s/iter; left time: 7608.4507s
Epoch: 2 cost time: 952.0624573230743
Epoch: 2, Steps: 3800 | Train Loss: 0.3309971 Vali Loss: 0.9634455 Test Loss: 1.7694521
EarlyStopping counter: 1 out of 3
Updating learning rate to 5e-05
	iters: 100, epoch: 3 | loss: 0.3228235
	speed: 6.9728s/iter; left time: 211281.3713s
	iters: 200, epoch: 3 | loss: 0.3275463
	speed: 0.2569s/iter; left time: 7759.6023s
	iters: 300, epoch: 3 | loss: 0.2925044
	speed: 0.2569s/iter; left time: 7732.8062s
	iters: 400, epoch: 3 | loss: 0.2765538
	speed: 0.2580s/iter; left time: 7740.9994s
	iters: 500, epoch: 3 | loss: 0.3042116
	speed: 0.2572s/iter; left time: 7691.8674s
	iters: 600, epoch: 3 | loss: 0.3093272
	speed: 0.2613s/iter; left time: 7787.4998s
	iters: 700, epoch: 3 | loss: 0.2985346
	speed: 0.2602s/iter; left time: 7726.8320s
	iters: 800, epoch: 3 | loss: 0.2821887
	speed: 0.2623s/iter; left time: 7763.0404s
	iters: 900, epoch: 3 | loss: 0.2982314
	speed: 0.2608s/iter; left time: 7693.0523s
	iters: 1000, epoch: 3 | loss: 0.2753167
	speed: 0.2601s/iter; left time: 7646.7414s
	iters: 1100, epoch: 3 | loss: 0.3001108
	speed: 0.2625s/iter; left time: 7692.6421s
	iters: 1200, epoch: 3 | loss: 0.2994398
	speed: 0.2598s/iter; left time: 7587.5916s
	iters: 1300, epoch: 3 | loss: 0.3029495
	speed: 0.2602s/iter; left time: 7571.1383s
	iters: 1400, epoch: 3 | loss: 0.2950317
	speed: 0.2598s/iter; left time: 7534.6390s
	iters: 1500, epoch: 3 | loss: 0.2786305
	speed: 0.2592s/iter; left time: 7491.9930s
	iters: 1600, epoch: 3 | loss: 0.3301046
	speed: 0.2611s/iter; left time: 7521.3516s
	iters: 1700, epoch: 3 | loss: 0.3179199
	speed: 0.2590s/iter; left time: 7434.3241s
	iters: 1800, epoch: 3 | loss: 0.3252266
	speed: 0.2593s/iter; left time: 7415.2135s
	iters: 1900, epoch: 3 | loss: 0.2807212
	speed: 0.2591s/iter; left time: 7383.9493s
	iters: 2000, epoch: 3 | loss: 0.2901972
	speed: 0.2614s/iter; left time: 7425.4085s
	iters: 2100, epoch: 3 | loss: 0.3174314
	speed: 0.2594s/iter; left time: 7341.8353s
	iters: 2200, epoch: 3 | loss: 0.2971291
	speed: 0.2591s/iter; left time: 7308.1257s
	iters: 2300, epoch: 3 | loss: 0.2872005
	speed: 0.2592s/iter; left time: 7284.5237s
	iters: 2400, epoch: 3 | loss: 0.2865982
	speed: 0.2613s/iter; left time: 7317.2841s
	iters: 2500, epoch: 3 | loss: 0.2885998
	speed: 0.2583s/iter; left time: 7207.1686s
	iters: 2600, epoch: 3 | loss: 0.3353713
	speed: 0.2610s/iter; left time: 7257.3648s
	iters: 2700, epoch: 3 | loss: 0.2810101
	speed: 0.2591s/iter; left time: 7178.0324s
	iters: 2800, epoch: 3 | loss: 0.3052518
	speed: 0.2589s/iter; left time: 7144.7826s
	iters: 2900, epoch: 3 | loss: 0.2959654
	speed: 0.2596s/iter; left time: 7140.0156s
	iters: 3000, epoch: 3 | loss: 0.2776904
	speed: 0.2617s/iter; left time: 7170.9004s
	iters: 3100, epoch: 3 | loss: 0.2895657
	speed: 0.2603s/iter; left time: 7106.4391s
	iters: 3200, epoch: 3 | loss: 0.2998581
	speed: 0.2603s/iter; left time: 7080.9122s
	iters: 3300, epoch: 3 | loss: 0.2850594
	speed: 0.2610s/iter; left time: 7072.9929s
	iters: 3400, epoch: 3 | loss: 0.3290051
	speed: 0.2599s/iter; left time: 7016.2187s
	iters: 3500, epoch: 3 | loss: 0.3020253
	speed: 0.2584s/iter; left time: 6952.0616s
	iters: 3600, epoch: 3 | loss: 0.2901967
	speed: 0.2588s/iter; left time: 6935.1052s
	iters: 3700, epoch: 3 | loss: 0.3137225
	speed: 0.2615s/iter; left time: 6981.1400s
	iters: 3800, epoch: 3 | loss: 0.3066815
	speed: 0.2590s/iter; left time: 6889.7030s
Epoch: 3 cost time: 990.2031097412109
Epoch: 3, Steps: 3800 | Train Loss: 0.2957221 Vali Loss: 0.9754644 Test Loss: 1.8681076
EarlyStopping counter: 2 out of 3
Updating learning rate to 2.5e-05
	iters: 100, epoch: 4 | loss: 0.2525977
	speed: 7.1263s/iter; left time: 188853.7719s
	iters: 200, epoch: 4 | loss: 0.2766621
	speed: 0.2610s/iter; left time: 6891.7483s
	iters: 300, epoch: 4 | loss: 0.2944692
	speed: 0.2612s/iter; left time: 6870.8397s
	iters: 400, epoch: 4 | loss: 0.3311951
	speed: 0.2611s/iter; left time: 6841.4331s
	iters: 500, epoch: 4 | loss: 0.3137745
	speed: 0.2613s/iter; left time: 6820.3275s
	iters: 600, epoch: 4 | loss: 0.2842385
	speed: 0.2613s/iter; left time: 6792.9240s
	iters: 700, epoch: 4 | loss: 0.2683967
	speed: 0.2615s/iter; left time: 6773.4476s
	iters: 800, epoch: 4 | loss: 0.2780577
	speed: 0.2613s/iter; left time: 6741.7864s
	iters: 900, epoch: 4 | loss: 0.2739964
	speed: 0.2613s/iter; left time: 6715.2406s
	iters: 1000, epoch: 4 | loss: 0.2662237
	speed: 0.2612s/iter; left time: 6687.6567s
	iters: 1100, epoch: 4 | loss: 0.2776641
	speed: 0.2603s/iter; left time: 6638.6131s
	iters: 1200, epoch: 4 | loss: 0.2688716
	speed: 0.2608s/iter; left time: 6623.7897s
	iters: 1300, epoch: 4 | loss: 0.2810461
	speed: 0.2581s/iter; left time: 6529.2688s
	iters: 1400, epoch: 4 | loss: 0.2521529
	speed: 0.2585s/iter; left time: 6514.5137s
	iters: 1500, epoch: 4 | loss: 0.2791387
	speed: 0.2591s/iter; left time: 6503.7120s
	iters: 1600, epoch: 4 | loss: 0.2768149
	speed: 0.2584s/iter; left time: 6461.0216s
	iters: 1700, epoch: 4 | loss: 0.2849402
	speed: 0.2587s/iter; left time: 6443.1074s
	iters: 1800, epoch: 4 | loss: 0.2803487
	speed: 0.2603s/iter; left time: 6456.4342s
	iters: 1900, epoch: 4 | loss: 0.2651767
	speed: 0.2590s/iter; left time: 6397.8148s
	iters: 2000, epoch: 4 | loss: 0.2636513
	speed: 0.2601s/iter; left time: 6399.9091s
	iters: 2100, epoch: 4 | loss: 0.3106884
	speed: 0.2606s/iter; left time: 6384.7640s
	iters: 2200, epoch: 4 | loss: 0.3042738
	speed: 0.2608s/iter; left time: 6364.1277s
	iters: 2300, epoch: 4 | loss: 0.2845500
	speed: 0.2610s/iter; left time: 6343.6222s
	iters: 2400, epoch: 4 | loss: 0.2658236
	speed: 0.2594s/iter; left time: 6278.2020s
	iters: 2500, epoch: 4 | loss: 0.2956253
	speed: 0.2582s/iter; left time: 6222.7764s
	iters: 2600, epoch: 4 | loss: 0.2588351
	speed: 0.2580s/iter; left time: 6191.8586s
	iters: 2700, epoch: 4 | loss: 0.3028492
	speed: 0.2584s/iter; left time: 6177.2055s
	iters: 2800, epoch: 4 | loss: 0.2749428
	speed: 0.2584s/iter; left time: 6150.4023s
	iters: 2900, epoch: 4 | loss: 0.2904203
	speed: 0.2586s/iter; left time: 6128.6309s
	iters: 3000, epoch: 4 | loss: 0.2718543
	speed: 0.2579s/iter; left time: 6085.6899s
	iters: 3100, epoch: 4 | loss: 0.2746342
	speed: 0.2581s/iter; left time: 6066.6721s
	iters: 3200, epoch: 4 | loss: 0.2690044
	speed: 0.2579s/iter; left time: 6034.6671s
	iters: 3300, epoch: 4 | loss: 0.3144989
	speed: 0.2583s/iter; left time: 6017.9219s
	iters: 3400, epoch: 4 | loss: 0.2604830
	speed: 0.2595s/iter; left time: 6020.1895s
	iters: 3500, epoch: 4 | loss: 0.2769788
	speed: 0.2580s/iter; left time: 5959.6333s
	iters: 3600, epoch: 4 | loss: 0.2761729
	speed: 0.2576s/iter; left time: 5924.3421s
	iters: 3700, epoch: 4 | loss: 0.2663494
	speed: 0.2600s/iter; left time: 5955.3238s
	iters: 3800, epoch: 4 | loss: 0.2709608
	speed: 0.2573s/iter; left time: 5867.8095s
Epoch: 4 cost time: 989.3061122894287
Epoch: 4, Steps: 3800 | Train Loss: 0.2807447 Vali Loss: 0.9783624 Test Loss: 1.8160203
EarlyStopping counter: 3 out of 3
Early stopping
>>>>>>>testing : long_term_forecast_pems07_all_96_336_Mamba_custom_ftM_sl336_ll48_pl336_dm128_nh8_el2_dl1_df16_fc1_ebtimeF_dtTrue_srate0.1_sseed7_trainseed2024_gap548_Exp_0<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 300097
test shape: (30009, 1, 336, 1613) (30009, 1, 336, 1613)
test shape: (30009, 336, 1613) (30009, 336, 1613)

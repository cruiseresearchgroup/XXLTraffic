Args in experiment:
Namespace(activation='gelu', anomaly_ratio=0.25, batch_size=32, c_out=151, checkpoints='./checkpoints/', d_conv=4, d_ff=16, d_layers=1, d_model=128, data='custom', data_path='pems03_all_common_flow.csv', dec_in=151, des='Exp', devices='0,1,2,3', distil=True, dropout=0, e_layers=2, embed='timeF', enc_in=151, expand=2, factor=1, features='M', freq='h', gap_day=365, gpu=0, inverse=False, is_training=1, itr=1, label_len=48, learning_rate=0.0001, loss='MSE', lradj='type1', mask_rate=0.25, model='Mamba', model_id='pems03_all_96_336', moving_avg=25, n_heads=8, num_kernels=6, num_workers=10, output_attention=False, p_hidden_dims=[128, 128], p_hidden_layers=2, patience=3, pred_len=336, root_path='../../data/pems/', samle_rate=0.1, sample_seed=7, seasonal_patterns='Monthly', seq_len=336, target='OT', task_name='long_term_forecast', top_k=5, train_epochs=10, train_seed=2024, use_amp=False, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
>>>>>>>start training : long_term_forecast_pems03_all_96_336_Mamba_custom_ftM_sl336_ll48_pl336_dm128_nh8_el2_dl1_df16_fc1_ebtimeF_dtTrue_srate0.1_sseed7_trainseed2024_gap365_Exp_0>>>>>>>>>>>>>>>>>>>>>>>>>>
train 1269398
val 352942
test 352941
	iters: 100, epoch: 1 | loss: 0.8112543
	speed: 0.0455s/iter; left time: 1798.7727s
	iters: 200, epoch: 1 | loss: 0.7472010
	speed: 0.0254s/iter; left time: 1003.4545s
	iters: 300, epoch: 1 | loss: 0.7762418
	speed: 0.0259s/iter; left time: 1018.2963s
	iters: 400, epoch: 1 | loss: 0.7397308
	speed: 0.0254s/iter; left time: 998.7659s
	iters: 500, epoch: 1 | loss: 0.6530841
	speed: 0.0255s/iter; left time: 999.2036s
	iters: 600, epoch: 1 | loss: 0.6355809
	speed: 0.0256s/iter; left time: 1000.0329s
	iters: 700, epoch: 1 | loss: 0.6590480
	speed: 0.0255s/iter; left time: 993.9667s
	iters: 800, epoch: 1 | loss: 0.6634975
	speed: 0.0263s/iter; left time: 1023.9745s
	iters: 900, epoch: 1 | loss: 0.6242772
	speed: 0.0272s/iter; left time: 1055.7108s
	iters: 1000, epoch: 1 | loss: 0.6081936
	speed: 0.0270s/iter; left time: 1042.9115s
	iters: 1100, epoch: 1 | loss: 0.7202652
	speed: 0.0271s/iter; left time: 1043.4933s
	iters: 1200, epoch: 1 | loss: 0.6553110
	speed: 0.0270s/iter; left time: 1039.4261s
	iters: 1300, epoch: 1 | loss: 0.5979500
	speed: 0.0264s/iter; left time: 1011.0514s
	iters: 1400, epoch: 1 | loss: 0.5338153
	speed: 0.0267s/iter; left time: 1021.2116s
	iters: 1500, epoch: 1 | loss: 0.5701212
	speed: 0.0265s/iter; left time: 1012.7311s
	iters: 1600, epoch: 1 | loss: 0.5770366
	speed: 0.0266s/iter; left time: 1011.5407s
	iters: 1700, epoch: 1 | loss: 0.6357405
	speed: 0.0266s/iter; left time: 1010.5364s
	iters: 1800, epoch: 1 | loss: 0.6389341
	speed: 0.0266s/iter; left time: 1005.4971s
	iters: 1900, epoch: 1 | loss: 0.5497637
	speed: 0.0263s/iter; left time: 992.0588s
	iters: 2000, epoch: 1 | loss: 0.6105046
	speed: 0.0262s/iter; left time: 985.2805s
	iters: 2100, epoch: 1 | loss: 0.6208676
	speed: 0.0261s/iter; left time: 981.9357s
	iters: 2200, epoch: 1 | loss: 0.5921193
	speed: 0.0261s/iter; left time: 979.0746s
	iters: 2300, epoch: 1 | loss: 0.6338335
	speed: 0.0259s/iter; left time: 968.8757s
	iters: 2400, epoch: 1 | loss: 0.6041352
	speed: 0.0258s/iter; left time: 960.2275s
	iters: 2500, epoch: 1 | loss: 0.5766691
	speed: 0.0258s/iter; left time: 958.0549s
	iters: 2600, epoch: 1 | loss: 0.5417206
	speed: 0.0258s/iter; left time: 955.1415s
	iters: 2700, epoch: 1 | loss: 0.5528038
	speed: 0.0258s/iter; left time: 952.5762s
	iters: 2800, epoch: 1 | loss: 0.6072754
	speed: 0.0257s/iter; left time: 947.1136s
	iters: 2900, epoch: 1 | loss: 0.5475226
	speed: 0.0253s/iter; left time: 931.8405s
	iters: 3000, epoch: 1 | loss: 0.5907756
	speed: 0.0255s/iter; left time: 936.5848s
	iters: 3100, epoch: 1 | loss: 0.5955573
	speed: 0.0254s/iter; left time: 929.9988s
	iters: 3200, epoch: 1 | loss: 0.5218177
	speed: 0.0254s/iter; left time: 925.1935s
	iters: 3300, epoch: 1 | loss: 0.5231931
	speed: 0.0259s/iter; left time: 940.1502s
	iters: 3400, epoch: 1 | loss: 0.5435898
	speed: 0.0254s/iter; left time: 920.8965s
	iters: 3500, epoch: 1 | loss: 0.5406364
	speed: 0.0255s/iter; left time: 921.7141s
	iters: 3600, epoch: 1 | loss: 0.5001558
	speed: 0.0259s/iter; left time: 933.4644s
	iters: 3700, epoch: 1 | loss: 0.5195090
	speed: 0.0253s/iter; left time: 910.1667s
	iters: 3800, epoch: 1 | loss: 0.5359897
	speed: 0.0254s/iter; left time: 909.3224s
	iters: 3900, epoch: 1 | loss: 0.6381714
	speed: 0.0254s/iter; left time: 908.9363s
Epoch: 1 cost time: 105.05266547203064
Epoch: 1, Steps: 3966 | Train Loss: 0.6168764 Vali Loss: 1.2642980 Test Loss: 1.4340006
Validation loss decreased (inf --> 1.264298).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 2 | loss: 0.5308650
	speed: 1.1192s/iter; left time: 39836.6325s
	iters: 200, epoch: 2 | loss: 0.5457490
	speed: 0.0254s/iter; left time: 900.0773s
	iters: 300, epoch: 2 | loss: 0.5202069
	speed: 0.0253s/iter; left time: 894.9375s
	iters: 400, epoch: 2 | loss: 0.4824564
	speed: 0.0255s/iter; left time: 898.8630s
	iters: 500, epoch: 2 | loss: 0.4915628
	speed: 0.0255s/iter; left time: 898.8871s
	iters: 600, epoch: 2 | loss: 0.5493514
	speed: 0.0251s/iter; left time: 881.0738s
	iters: 700, epoch: 2 | loss: 0.5026001
	speed: 0.0258s/iter; left time: 902.2439s
	iters: 800, epoch: 2 | loss: 0.5380999
	speed: 0.0258s/iter; left time: 900.3696s
	iters: 900, epoch: 2 | loss: 0.5098318
	speed: 0.0258s/iter; left time: 898.0156s
	iters: 1000, epoch: 2 | loss: 0.5420426
	speed: 0.0258s/iter; left time: 895.2469s
	iters: 1100, epoch: 2 | loss: 0.5148727
	speed: 0.0258s/iter; left time: 891.8426s
	iters: 1200, epoch: 2 | loss: 0.5304381
	speed: 0.0257s/iter; left time: 887.6485s
	iters: 1300, epoch: 2 | loss: 0.5166441
	speed: 0.0257s/iter; left time: 883.1610s
	iters: 1400, epoch: 2 | loss: 0.5370997
	speed: 0.0257s/iter; left time: 882.6672s
	iters: 1500, epoch: 2 | loss: 0.5774866
	speed: 0.0257s/iter; left time: 879.7226s
	iters: 1600, epoch: 2 | loss: 0.4765472
	speed: 0.0257s/iter; left time: 877.3251s
	iters: 1700, epoch: 2 | loss: 0.5413442
	speed: 0.0258s/iter; left time: 876.3728s
	iters: 1800, epoch: 2 | loss: 0.5631107
	speed: 0.0258s/iter; left time: 873.6660s
	iters: 1900, epoch: 2 | loss: 0.5141544
	speed: 0.0266s/iter; left time: 897.5167s
	iters: 2000, epoch: 2 | loss: 0.5674427
	speed: 0.0260s/iter; left time: 876.1750s
	iters: 2100, epoch: 2 | loss: 0.5319866
	speed: 0.0259s/iter; left time: 870.5313s
	iters: 2200, epoch: 2 | loss: 0.5357075
	speed: 0.0257s/iter; left time: 859.6631s
	iters: 2300, epoch: 2 | loss: 0.5501513
	speed: 0.0260s/iter; left time: 867.2758s
	iters: 2400, epoch: 2 | loss: 0.4885964
	speed: 0.0262s/iter; left time: 872.1646s
	iters: 2500, epoch: 2 | loss: 0.5868578
	speed: 0.0266s/iter; left time: 884.5522s
	iters: 2600, epoch: 2 | loss: 0.5668873
	speed: 0.0269s/iter; left time: 889.3863s
	iters: 2700, epoch: 2 | loss: 0.5078086
	speed: 0.0269s/iter; left time: 886.4995s
	iters: 2800, epoch: 2 | loss: 0.4964335
	speed: 0.0270s/iter; left time: 886.7868s
	iters: 2900, epoch: 2 | loss: 0.5501434
	speed: 0.0265s/iter; left time: 869.0705s
	iters: 3000, epoch: 2 | loss: 0.5070169
	speed: 0.0263s/iter; left time: 858.3439s
	iters: 3100, epoch: 2 | loss: 0.4905961
	speed: 0.0267s/iter; left time: 871.0333s
	iters: 3200, epoch: 2 | loss: 0.5058603
	speed: 0.0255s/iter; left time: 829.4051s
	iters: 3300, epoch: 2 | loss: 0.5040018
	speed: 0.0257s/iter; left time: 833.1525s
	iters: 3400, epoch: 2 | loss: 0.4921680
	speed: 0.0254s/iter; left time: 820.7332s
	iters: 3500, epoch: 2 | loss: 0.5427639
	speed: 0.0254s/iter; left time: 817.9453s
	iters: 3600, epoch: 2 | loss: 0.5215386
	speed: 0.0257s/iter; left time: 823.2385s
	iters: 3700, epoch: 2 | loss: 0.4380323
	speed: 0.0254s/iter; left time: 813.6597s
	iters: 3800, epoch: 2 | loss: 0.5743451
	speed: 0.0255s/iter; left time: 812.7659s
	iters: 3900, epoch: 2 | loss: 0.4798473
	speed: 0.0255s/iter; left time: 810.6244s
Epoch: 2 cost time: 102.97167897224426
Epoch: 2, Steps: 3966 | Train Loss: 0.5257872 Vali Loss: 1.2700037 Test Loss: 1.4704896
EarlyStopping counter: 1 out of 3
Updating learning rate to 5e-05
	iters: 100, epoch: 3 | loss: 0.5293737
	speed: 1.1395s/iter; left time: 36040.3224s
	iters: 200, epoch: 3 | loss: 0.4598869
	speed: 0.0260s/iter; left time: 821.2655s
	iters: 300, epoch: 3 | loss: 0.5823083
	speed: 0.0257s/iter; left time: 807.2689s
	iters: 400, epoch: 3 | loss: 0.5009785
	speed: 0.0257s/iter; left time: 806.4799s
	iters: 500, epoch: 3 | loss: 0.4906920
	speed: 0.0260s/iter; left time: 811.6960s
	iters: 600, epoch: 3 | loss: 0.4759371
	speed: 0.0255s/iter; left time: 794.9529s
	iters: 700, epoch: 3 | loss: 0.4913791
	speed: 0.0256s/iter; left time: 795.1994s
	iters: 800, epoch: 3 | loss: 0.4819247
	speed: 0.0257s/iter; left time: 795.4583s
	iters: 900, epoch: 3 | loss: 0.5233317
	speed: 0.0257s/iter; left time: 793.3980s
	iters: 1000, epoch: 3 | loss: 0.4979317
	speed: 0.0257s/iter; left time: 788.5711s
	iters: 1100, epoch: 3 | loss: 0.4604458
	speed: 0.0257s/iter; left time: 786.2593s
	iters: 1200, epoch: 3 | loss: 0.4991325
	speed: 0.0253s/iter; left time: 773.7817s
	iters: 1300, epoch: 3 | loss: 0.4927782
	speed: 0.0253s/iter; left time: 770.5756s
	iters: 1400, epoch: 3 | loss: 0.5175457
	speed: 0.0253s/iter; left time: 767.6068s
	iters: 1500, epoch: 3 | loss: 0.4790509
	speed: 0.0255s/iter; left time: 770.2047s
	iters: 1600, epoch: 3 | loss: 0.5022079
	speed: 0.0251s/iter; left time: 756.2588s
	iters: 1700, epoch: 3 | loss: 0.4907679
	speed: 0.0251s/iter; left time: 755.2151s
	iters: 1800, epoch: 3 | loss: 0.4822655
	speed: 0.0252s/iter; left time: 754.8708s
	iters: 1900, epoch: 3 | loss: 0.5461472
	speed: 0.0255s/iter; left time: 759.5499s
	iters: 2000, epoch: 3 | loss: 0.4922026
	speed: 0.0252s/iter; left time: 749.2280s
	iters: 2100, epoch: 3 | loss: 0.5263369
	speed: 0.0252s/iter; left time: 745.6959s
	iters: 2200, epoch: 3 | loss: 0.4649081
	speed: 0.0252s/iter; left time: 742.9158s
	iters: 2300, epoch: 3 | loss: 0.4816463
	speed: 0.0252s/iter; left time: 740.2288s
	iters: 2400, epoch: 3 | loss: 0.4944552
	speed: 0.0252s/iter; left time: 739.6000s
	iters: 2500, epoch: 3 | loss: 0.4488424
	speed: 0.0252s/iter; left time: 737.6774s
	iters: 2600, epoch: 3 | loss: 0.4754692
	speed: 0.0252s/iter; left time: 733.5682s
	iters: 2700, epoch: 3 | loss: 0.5510024
	speed: 0.0252s/iter; left time: 731.6941s
	iters: 2800, epoch: 3 | loss: 0.5489920
	speed: 0.0251s/iter; left time: 726.8936s
	iters: 2900, epoch: 3 | loss: 0.4715327
	speed: 0.0251s/iter; left time: 723.0779s
	iters: 3000, epoch: 3 | loss: 0.5469635
	speed: 0.0251s/iter; left time: 722.1211s
	iters: 3100, epoch: 3 | loss: 0.4889120
	speed: 0.0251s/iter; left time: 719.8545s
	iters: 3200, epoch: 3 | loss: 0.4999339
	speed: 0.0252s/iter; left time: 719.6860s
	iters: 3300, epoch: 3 | loss: 0.5038431
	speed: 0.0252s/iter; left time: 716.3435s
	iters: 3400, epoch: 3 | loss: 0.4495546
	speed: 0.0253s/iter; left time: 716.3819s
	iters: 3500, epoch: 3 | loss: 0.5033501
	speed: 0.0253s/iter; left time: 713.3251s
	iters: 3600, epoch: 3 | loss: 0.5121972
	speed: 0.0252s/iter; left time: 708.1203s
	iters: 3700, epoch: 3 | loss: 0.5407118
	speed: 0.0253s/iter; left time: 709.1849s
	iters: 3800, epoch: 3 | loss: 0.4393167
	speed: 0.0252s/iter; left time: 705.0730s
	iters: 3900, epoch: 3 | loss: 0.4956530
	speed: 0.0254s/iter; left time: 706.8474s
Epoch: 3 cost time: 101.15371942520142
Epoch: 3, Steps: 3966 | Train Loss: 0.5020632 Vali Loss: 1.2755841 Test Loss: 1.4439678
EarlyStopping counter: 2 out of 3
Updating learning rate to 2.5e-05
	iters: 100, epoch: 4 | loss: 0.5037187
	speed: 1.5898s/iter; left time: 43978.7257s
	iters: 200, epoch: 4 | loss: 0.4963121
	speed: 0.0278s/iter; left time: 766.9400s
	iters: 300, epoch: 4 | loss: 0.4962085
	speed: 0.0275s/iter; left time: 754.6209s
	iters: 400, epoch: 4 | loss: 0.4927789
	speed: 0.0280s/iter; left time: 766.7580s
	iters: 500, epoch: 4 | loss: 0.4528528
	speed: 0.0268s/iter; left time: 730.1867s
	iters: 600, epoch: 4 | loss: 0.4775623
	speed: 0.0278s/iter; left time: 755.5179s
	iters: 700, epoch: 4 | loss: 0.4854022
	speed: 0.0276s/iter; left time: 746.4084s
	iters: 800, epoch: 4 | loss: 0.4630331
	speed: 0.0278s/iter; left time: 748.6519s
	iters: 900, epoch: 4 | loss: 0.5017869
	speed: 0.0278s/iter; left time: 747.4244s
	iters: 1000, epoch: 4 | loss: 0.5538357
	speed: 0.0275s/iter; left time: 737.0520s
	iters: 1100, epoch: 4 | loss: 0.4602776
	speed: 0.0277s/iter; left time: 739.2046s
	iters: 1200, epoch: 4 | loss: 0.4916439
	speed: 0.0275s/iter; left time: 731.6166s
	iters: 1300, epoch: 4 | loss: 0.4789628
	speed: 0.0276s/iter; left time: 730.9532s
	iters: 1400, epoch: 4 | loss: 0.5454489
	speed: 0.0273s/iter; left time: 719.0194s
	iters: 1500, epoch: 4 | loss: 0.4424141
	speed: 0.0272s/iter; left time: 715.3376s
	iters: 1600, epoch: 4 | loss: 0.5224743
	speed: 0.0272s/iter; left time: 710.9879s
	iters: 1700, epoch: 4 | loss: 0.4331041
	speed: 0.0270s/iter; left time: 703.9708s
	iters: 1800, epoch: 4 | loss: 0.5211480
	speed: 0.0272s/iter; left time: 706.9617s
	iters: 1900, epoch: 4 | loss: 0.5685080
	speed: 0.0274s/iter; left time: 708.9739s
	iters: 2000, epoch: 4 | loss: 0.4992695
	speed: 0.0274s/iter; left time: 706.1533s
	iters: 2100, epoch: 4 | loss: 0.4407103
	speed: 0.0275s/iter; left time: 706.6243s
	iters: 2200, epoch: 4 | loss: 0.4805524
	speed: 0.0273s/iter; left time: 697.0788s
	iters: 2300, epoch: 4 | loss: 0.5263900
	speed: 0.0269s/iter; left time: 685.9565s
	iters: 2400, epoch: 4 | loss: 0.5013688
	speed: 0.0284s/iter; left time: 720.3555s
	iters: 2500, epoch: 4 | loss: 0.4624581
	speed: 0.0295s/iter; left time: 746.4227s
	iters: 2600, epoch: 4 | loss: 0.4608863
	speed: 0.0285s/iter; left time: 716.8681s
	iters: 2700, epoch: 4 | loss: 0.4712314
	speed: 0.0275s/iter; left time: 689.8237s
	iters: 2800, epoch: 4 | loss: 0.4766571
	speed: 0.0267s/iter; left time: 666.9149s
	iters: 2900, epoch: 4 | loss: 0.5141995
	speed: 0.0279s/iter; left time: 694.4414s
	iters: 3000, epoch: 4 | loss: 0.5374953
	speed: 0.0273s/iter; left time: 676.2377s
	iters: 3100, epoch: 4 | loss: 0.5034429
	speed: 0.0276s/iter; left time: 679.7095s
	iters: 3200, epoch: 4 | loss: 0.4890484
	speed: 0.0297s/iter; left time: 730.3535s
	iters: 3300, epoch: 4 | loss: 0.5173048
	speed: 0.0286s/iter; left time: 700.3498s
	iters: 3400, epoch: 4 | loss: 0.4781413
	speed: 0.0294s/iter; left time: 715.1904s
	iters: 3500, epoch: 4 | loss: 0.4927292
	speed: 0.0282s/iter; left time: 685.3746s
	iters: 3600, epoch: 4 | loss: 0.5409959
	speed: 0.0294s/iter; left time: 709.9278s
	iters: 3700, epoch: 4 | loss: 0.4900834
	speed: 0.0294s/iter; left time: 707.4143s
	iters: 3800, epoch: 4 | loss: 0.4699401
	speed: 0.0296s/iter; left time: 709.2408s
	iters: 3900, epoch: 4 | loss: 0.4450452
	speed: 0.0295s/iter; left time: 704.3252s
Epoch: 4 cost time: 111.61680674552917
Epoch: 4, Steps: 3966 | Train Loss: 0.4928780 Vali Loss: 1.2840641 Test Loss: 1.4799885
EarlyStopping counter: 3 out of 3
Early stopping
>>>>>>>testing : long_term_forecast_pems03_all_96_336_Mamba_custom_ftM_sl336_ll48_pl336_dm128_nh8_el2_dl1_df16_fc1_ebtimeF_dtTrue_srate0.1_sseed7_trainseed2024_gap365_Exp_0<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 352941
test shape: (35294, 1, 336, 151) (35294, 1, 336, 151)
test shape: (35294, 336, 151) (35294, 336, 151)
mse:1.4340076446533203, mae:0.9127892851829529
>>>>>>>Overall time: 1233 seconds<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
